<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>题目打印工具</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script id="MathJax-script" async src=".\mathjax\mathjax\es5\tex-mml-chtml.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f8f8f8;
        }
        .main-layout {
            display: flex;
            align-items: flex-start;
            width: 100%;
            min-height: 100vh;
            background: #f8f8f8;
        }
        .sidebar {
            width: 220px;
            min-width: 180px;
            flex-shrink: 0;
            background: #f6faff;
            border-radius: 8px;
            padding: 18px 10px 18px 10px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            box-sizing: border-box;
            margin: 30px 0 30px 30px;
            height: fit-content;
        }
        .type-select {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 30px;
        }
        .type-item {
            background: #eaf4fb;
            border-radius: 6px;
            padding: 10px 10px 10px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .type-item input[type="number"] {
            width: 50px;
            padding: 2px 4px;
        }
        .sidebar .actions {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .sidebar .actions button {
            width: 100%;
            margin: 0;
            padding: 10px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: #2196F3;
            color: #fff;
            cursor: pointer;
        }
        .sidebar .actions button:hover {
            background: #1769aa;
        }
        .container {
            max-width: 1200px;
            margin: 30px auto 30px 0;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px #ddd;
            padding: 30px 30px 50px 30px;
            flex: 1;
            min-width: 0;
            min-height: 600px;
        }
        h2 {
            text-align: center;
            margin-bottom: 30px;
        }
        .preview-area {
            flex: 1;
            min-width: 0;
        }
        .qa-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .qa-table th, .qa-table td {
            border: 1px solid #ccc;
            padding: 10px;
            vertical-align: top;
        }
        .qa-table th {
            background: #f4f4f4;
        }
        @media print {
            body, .container {
                background: #fff !important;
                box-shadow: none !important;
            }
            .actions, .type-select, .sidebar, h2 {
                display: none !important;
            }
            .preview-area {
                margin: 0;
                padding: 0;
            }
            .qa-table th, .qa-table td {
                font-size: 15px;
                padding: 8px;
            }
        }
        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
                align-items: stretch;
            }
            .sidebar {
                width: 100%;
                min-width: 0;
                margin: 0 0 20px 0;
                border-radius: 0;
                flex-direction: row;
                align-items: flex-start;
                padding: 10px 0 0 0;
            }
            .type-select {
                flex: 1;
                margin-bottom: 0;
            }
            .sidebar .actions {
                flex: none;
                margin-top: 0;
                margin-left: 10px;
            }
            .container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
<div class="main-layout">
    <div class="sidebar">
    <div class="type-select" id="typeSelect"></div>
    <div class="actions">
        <button onclick="generateAllQuestions()">生成题目</button>
        <button onclick="window.print()">打印/导出PDF</button>
    </div>
    </div>
    <div class="container">
        <h2>题目打印工具</h2>
    <div class="preview-area" id="previewArea">
        <div style="text-align:center;color:#888;">请先选择题型和数量，点击"生成题目"</div>
        </div>
    </div>
</div>
<script>
// 题型配置
// const difficultyNames = [
//     "01燕尾模型", 
//     "02燕尾模型两外比", 
//     "03燕尾模型一内一外比",
//     "04燕尾模型两内比",
//     "05鸟头模型",
//     "06燕尾模型矩形面积",
//     "07综合测试"
// ];

// 题目生成函数映射
// const questionGenerators = [
//     generateLevel1Question,
//     generateLevel2Question,
//     generateLevel3Question,
//     generateLevel4Question,
//     generateLevel5Question,
//     generateLevel6Question,
//     generateLevel7Question
// ];

// 生成题型选择区
function renderTypeSelect() {
    const container = document.getElementById('typeSelect');
    container.innerHTML = '';
    typeGroups.forEach((group, gIdx) => {
        const groupDiv = document.createElement('div');
        groupDiv.style.marginBottom = '18px';
        // 分组标题
        const groupTitle = document.createElement('div');
        groupTitle.style.fontWeight = 'bold';
        groupTitle.style.fontSize = '16px';
        groupTitle.style.color = '#2196F3';
        groupTitle.style.marginBottom = '6px';
        groupTitle.style.cursor = 'pointer';
        groupTitle.textContent = group.group;
        groupDiv.appendChild(groupTitle);
        // 题型项容器
        const itemsContainer = document.createElement('div');
        itemsContainer.style.display = 'none'; // 默认隐藏
        group.types.forEach((type, tIdx) => {
            const idx = `${gIdx}_${tIdx}`;
            const item = document.createElement('div');
            item.className = 'type-item';
            item.style.display = 'none'; // 默认隐藏
            item.innerHTML = `
                <input type="checkbox" id="type${idx}">
                <label for="type${idx}">${type.name}</label>
                <span>数量</span>
                <input type="number" id="num${idx}" min="1" max="50" value="3">
            `;
            itemsContainer.appendChild(item);
        });
        groupDiv.appendChild(itemsContainer);
        // 分组标题点击展开/收起
        groupTitle.addEventListener('click', function() {
            if (itemsContainer.style.display === 'none') {
                itemsContainer.style.display = '';
                Array.from(itemsContainer.children).forEach(e => e.style.display = '');
            } else {
                itemsContainer.style.display = 'none';
                Array.from(itemsContainer.children).forEach(e => e.style.display = 'none');
            }
        });
        container.appendChild(groupDiv);
    });
}

// 生成所有题目
function generateAllQuestions() {
    const preview = document.getElementById('previewArea');
    let allQAs = [];
    // difficultyNames.forEach((name, idx) => {
    //     const checked = document.getElementById(`type${idx}`).checked;
    //     const num = parseInt(document.getElementById(`num${idx}`).value);
    //     if (checked && num > 0) {
    //         for (let i = 0; i < num; i++) {
    //             let correctAnswer = [];
    //             window.correctAnswer = correctAnswer; // 兼容原函数
    //             const qHtml = questionGenerators[idx]();
    //             const aText = (window.correctAnswer || []).join(' 或 ');
    //             allQAs.push({
    //                 type: name,
    //                 qHtml,
    //                 aText
    //             });
    //         }
    //     }
    // });
    if (allQAs.length === 0) {
        preview.innerHTML = '<div style="text-align:center;color:#888;">请至少选择一个题型并设置题目数量</div>';
        return;
    }
    let html = '<table class="qa-table"><thead><tr><th>题型</th><th>题目</th><th>答案</th></tr></thead><tbody>';
    allQAs.forEach((qa, idx) => {
        html += `<tr><td>${qa.type}</td><td>${qa.qHtml}</td><td>\(${qa.aText}\)</td></tr>`;
    });
    html += '</tbody></table>';
    preview.innerHTML = html;
    MathJax.typesetPromise([preview]);
}

// 公因数
function gcd(x, y) {
    while (y != 0) {
        let temp = y;
        y = x % y;
        x = temp;
    }
    return x;
}

// 题目生成函数
function generateLevel1Question() {
     // 生成随机比例
    let ratio1 = Math.floor(Math.random() * 5) + 1;  // 1 to 5
    let ratio2 = Math.floor(Math.random() * 5) + 1;  // 1 to 5

    // 计算最大公约数
    let divisor = gcd(ratio1, ratio2);

    // 将比例化为最简比
    let simplifiedRatio1 = ratio1 / divisor;
    let simplifiedRatio2 = ratio2 / divisor;

    // 生成随机高度因子，确保面积为整数
    let heightFactor = Math.floor(Math.random() * 10) + 1;  // 1 to 10

    // 计算面积
    let S1 = ratio1 * heightFactor;
    let S2 = ratio2 * heightFactor;

    // 计算图形中的位置
    const totalWidth = 160;
    const totalRatio = ratio1 + ratio2;
    const leftWidth = (ratio1 / totalRatio) * totalWidth;
    const dPosition = 20 + leftWidth; // x-coordinate of point D

    // 计算点E的位置 - E是AD上的任意点
    // 随机选择E在AD上的位置，距离A的比例为0.3到0.7之间
    const eRatio = 0.3 + Math.random() * 0.4; // E在AD上的位置比例
    const ePositionX = 100 - (100 - dPosition) * eRatio; // E的x坐标
    const ePositionY = 20 + (130 - 20) * eRatio; // E的y坐标

    // 计算三角形重心位置用于标注面积
    const leftCentroidX = (100 + 20 + ePositionX) / 3;
    const leftCentroidY = (20 + 130 + ePositionY) / 3;

    const rightCentroidX = (100 + ePositionX + 180) / 3;
    const rightCentroidY = (20 + 130 + ePositionY) / 3;

    // 创建SVG图形（优化版，完全按规范）
    const svg = `
    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
        <!-- 网格组 -->
        <g id="gridGroup">
            <line x1="20" y1="40" x2="180" y2="40" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="20" y1="85" x2="180" y2="85" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 坐标轴组 -->
        <g id="axisGroup">
            <line x1="20" y1="130" x2="180" y2="130" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 图形组 -->
        <g id="shapeGroup">
            <polygon points="100,20 20,130 ${ePositionX},${ePositionY}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
            <polygon points="100,20 ${ePositionX},${ePositionY} 180,130" fill="#e6ffe6" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 辅助线组 -->
        <g id="auxLineGroup">
            <line x1="100" y1="20" x2="${dPosition}" y2="130" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 点组 -->
        <g id="pointsGroup">
            <circle cx="100" cy="20" r="6" fill="#4CAF50"/>
            <circle cx="20" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="180" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="${dPosition}" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="${ePositionX}" cy="${ePositionY}" r="6" fill="#4CAF50"/>
        </g>
        <!-- 标签组 -->
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="100" y="10" text-anchor="middle">A</text>
            <text x="10" y="145" text-anchor="middle">B</text>
            <text x="190" y="145" text-anchor="middle">C</text>
            <text x="${dPosition}" y="145" text-anchor="middle">D</text>
            <text x="${ePositionX+15}" y="${ePositionY+15}" text-anchor="middle">E</text>
        </g>
        <!-- 面积标注 -->
        <g id="markersGroup" font-size="14" font-family="Arial" fill="#666">
            <text x="${leftCentroidX}" y="${leftCentroidY}" text-anchor="middle">S₁=${S1}</text>
            <text x="${rightCentroidX}" y="${rightCentroidY}" text-anchor="middle">S₂=?</text>
        </g>
    </svg>
    `;

    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        在△ABC中，AD将底边BC分成两段，<br>
        \\( BD:DC = ${simplifiedRatio1}:${simplifiedRatio2} \\)，E是AD上的一点，<br>
        \\( S_1 = ${S1} \\)，求右边部分的面积 \\( S_2 \\)。
        <div style="margin-top: 18px;">${svg}</div>
    </div>
    `;

    // 设置正确答案
    correctAnswer = [
        `${S2}`
    ];

    return question;
}

function generateLevel2Question() {
    // 随机生成比值
    let a = Math.floor(Math.random() * 4) + 1, b = Math.floor(Math.random() * 4) + 1, c = Math.floor(Math.random() * 4) + 1, d = Math.floor(Math.random() * 4) + 1;
    let gcdAB = gcd(a, b), gcdCD = gcd(c, d);
    let sa = a / gcdAB, sb = b / gcdAB, sc = c / gcdCD, sd = d / gcdCD;
    let e = b * d, f = a * c, gcdEF = gcd(e, f);
    let se = e / gcdEF, sf = f / gcdEF;
    correctAnswer = [`${sf}:${se}`];
    // SVG参数
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Gx = (sb * Ax + sa * Bx) / (sa + sb);
    let Gy = (sb * Ay + sa * By) / (sa + sb);
    let Dx = (sd * Bx + sc * Cx) / (sc + sd);
    let Dy = (sd * By + sc * Cy) / (sc + sd);
    let t = ((Dx - Gx) * (Ay - Gy) - (Ax - Gx) * (Dy - Gy)) / ((Dx - Gx) * (Cy - Gy) - (Cx - Gx) * (Dy - Gy));
    let Ex = Gx + t * (Cx - Gx);
    let Ey = Gy + t * (Cy - Gy);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${svgWidth}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${svgWidth}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ax}" y1="${Ay}" x2="${Dx}" y2="${Dy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
            <line x1="${Gx}" y1="${Gy}" x2="${Cx}" y2="${Cy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Gx}" cy="${Gy}" r="6" fill="#4CAF50"/>
            <circle cx="${Dx}" cy="${Dy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Gx-labelOffset}" y="${Gy}" text-anchor="middle">G</text>
            <text x="${Dx}" y="${Dy+labelOffset}" text-anchor="middle">D</text>
            <text x="${Ex+labelOffset}" y="${Ey-labelOffset}" text-anchor="middle">E</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，AG将AB分成两段，<br>
        \\( AG:GB = ${sa}:${sb} \\)，BD将BC分成两段，<br>
        \\( BD:DC = ${sc}:${sd} \\)，E为AD与GC交点，<br>
        求AE:EC。<div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel3Question() {
    let a = Math.floor(Math.random() * 3) + 1, b = Math.floor(Math.random() * 3) + 1, m = Math.floor(Math.random() * 3) + 1, n = Math.floor(Math.random() * 3) + 1;
    let areaBCO = (Math.floor(Math.random() * 4) + 1) * b * n;
    let areaABC = areaBCO * (a * (m + n) + b * n) / (b * n);
    areaABC = Math.round(areaABC);
    correctAnswer = [areaABC + ''];
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Gx = (b * Ax + a * Bx) / (a + b);
    let Gy = (b * Ay + a * By) / (a + b);
    let Ox = (n * Bx + m * Cx) / (m + n);
    let Oy = (n * By + m * Cy) / (m + n);
    let t = ((Ox - Gx) * (Ay - Gy) - (Ax - Gx) * (Oy - Gy)) / ((Ox - Gx) * (Cy - Gy) - (Cx - Gx) * (Oy - Gy));
    let Ex = Gx + t * (Cx - Gx);
    let Ey = Gy + t * (Cy - Gy);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${width}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${width}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ax}" y1="${Ay}" x2="${Ox}" y2="${Oy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
            <line x1="${Gx}" y1="${Gy}" x2="${Cx}" y2="${Cy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Gx}" cy="${Gy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ox}" cy="${Oy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Gx-labelOffset}" y="${Gy}" text-anchor="middle">G</text>
            <text x="${Ox}" y="${Oy+labelOffset}" text-anchor="middle">O</text>
            <text x="${Ex+labelOffset}" y="${Ey-labelOffset}" text-anchor="middle">E</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，AG将AB分成两段，<br>
        \\( AG:GB = ${a}:${b} \\)，BO将BC分成两段，<br>
        \\( BO:OC = ${m}:${n} \\)，E为AO与GC交点，<br>
        \\( S_{\\triangle BCO} = ${areaBCO} \\)，求 \\( S_{\\triangle ABC} \\)。<div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel4Question() {
    // 生成AG:GB = a:b (化简后的比例)
    let a = Math.floor(Math.random() * 3) + 1;
    let b = Math.floor(Math.random() * 3) + 1;
    // 生成BD:DC = m:n (化简后的比例)
    let m = Math.floor(Math.random() * 3) + 1;
    let n = Math.floor(Math.random() * 3) + 1;

    // 生成一个随机的三角形BCO面积
    let areaBCO = (Math.floor(Math.random() * 4) + 1) * b * n;  // b*n的倍数
    // 根据燕尾模型，计算三角形ABC的面积
    // S_ABC = S_BCO * (a*(m+n) + b*n) / (b*n)
    let areaABC = areaBCO * (a * (m + n) + b * n) / (b * n);
    areaABC = Math.round(areaABC);

    // 三角形ABC的顶点
    const pointA = {x: 100, y: 20};
    const pointB = {x: 20, y: 130};
    const pointC = {x: 180, y: 130};

    // 计算点G在AB上的位置 (AG:GB = a:b)
    const pointG = {
        x: (a * pointB.x + b * pointA.x) / (a + b),
        y: (a * pointB.y + b * pointA.y) / (a + b)
    };
    // 计算点D在BC上的位置 (BD:DC = m:n)
    const pointD = {
        x: (m * pointC.x + n * pointB.x) / (m + n),
        y: (m * pointC.y + n * pointB.y) / (m + n)
    };
    // 3. CE:EA = b*n:a*m
    let ratioCE = b * n;
    let ratioEA = a * m;
    let gcdCEEA = gcd(ratioCE, ratioEA);
    let simplifiedCE = ratioCE / gcdCEEA;
    let simplifiedEA = ratioEA / gcdCEEA;
    // 4. AO:OD = a*(m+n):b*n
    let ratioAO = a * (m + n);
    let ratioOD = b * n;
    let gcdAOOD = gcd(ratioAO, ratioOD);
    let simplifiedAO = ratioAO / gcdAOOD;
    let simplifiedOD = ratioOD / gcdAOOD;
    // 5. BO:OE = (a*m + b*n):a*n
    let ratioBO = a * m + b * n;
    let ratioOE = a * n;
    let gcdBOOE = gcd(ratioBO, ratioOE);
    let simplifiedBO = ratioBO / gcdBOOE;
    let simplifiedOE = ratioOE / gcdBOOE;
    // 6. CO:OG = (a+b)*n:a*m
    let ratioCO = (a + b) * n;
    let ratioOG = a * m;
    let gcdCOOG = gcd(ratioCO, ratioOG);
    let simplifiedCO = ratioCO / gcdCOOG;
    let simplifiedOG = ratioOG / gcdCOOG;
    // 计算点E (CE:EA = b*n:a*m)
    const pointE = {
        x: (ratioEA * pointC.x + ratioCE * pointA.x) / (ratioCE + ratioEA),
        y: (ratioEA * pointC.y + ratioCE * pointA.y) / (ratioCE + ratioEA)
    };
    // 计算AD和CG的交点O
    const adDx = pointD.x - pointA.x;
    const adDy = pointD.y - pointA.y;
    const cgDx = pointG.x - pointC.x;
    const cgDy = pointG.y - pointC.y;
    const denominator = adDx * cgDy - adDy * cgDx;
    const t = ((pointC.x - pointA.x) * cgDy - (pointC.y - pointA.y) * cgDx) / denominator;
    const pointO = {
        x: pointA.x + t * adDx,
        y: pointA.y + t * adDy
    };
    // 创建SVG图形
    const svg = `
    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
        <!-- 三角形ABC -->
        <polygon points="${pointA.x},${pointA.y} ${pointB.x},${pointB.y} ${pointC.x},${pointC.y}" fill="#f0f8ff" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线AD -->
        <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointD.x}" y2="${pointD.y}" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线CG -->
        <line x1="${pointC.x}" y1="${pointC.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线BE -->
        <line x1="${pointB.x}" y1="${pointB.y}" x2="${pointE.x}" y2="${pointE.y}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3"/>
        <!-- 直线OO -->
        <line x1="${pointO.x}" y1="${pointO.y}" x2="${pointD.x}" y2="${pointD.y}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3"/>
        <!-- 标记三角形BCO区域 (填充浅绿色) -->
        <polygon points="${pointB.x},${pointB.y} ${pointC.x},${pointC.y} ${pointO.x},${pointO.y}" fill="#e6ffe6" stroke="#2196F3" stroke-width="1.5" stroke-dasharray="3,3"/>
        <!-- 顶点标注 -->
        <circle cx="${pointA.x}" cy="${pointA.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointB.x}" cy="${pointB.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointC.x}" cy="${pointC.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointD.x}" cy="${pointD.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointE.x}" cy="${pointE.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointG.x}" cy="${pointG.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointO.x}" cy="${pointO.y}" r="6" fill="#4CAF50"/>
        <text x="${pointA.x}" y="${pointA.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">A</text>
        <text x="${pointB.x-10}" y="${pointB.y+15}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">B</text>
        <text x="${pointC.x+10}" y="${pointC.y+15}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">C</text>
        <text x="${pointD.x}" y="${pointD.y+18}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">D</text>
        <text x="${pointE.x+15}" y="${pointE.y+5}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">E</text>
        <text x="${pointG.x-10}" y="${pointG.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">G</text>
        <text x="${pointO.x+10}" y="${pointO.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">O</text>
        <!-- 面积标注 -->
        <text x="${(pointB.x + pointC.x + pointO.x)/3}" y="${(pointB.y + pointC.y + pointO.y)/3}" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">S△BCO=${areaBCO}</text>
    </svg>
    `;
    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，三角形ABC中，\\
        BO:OE = ${simplifiedBO}:${simplifiedOE}，
        CO:OG = ${simplifiedCO}:${simplifiedOG}，\\
        S_{\\triangle BCO} = ${areaBCO}平方厘米，\\
        则S_{\\triangle ABC} = \\_平方厘米。
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateLevel5Question() {
    let a = Math.floor(Math.random() * 5) + 1, b = Math.floor(Math.random() * 5) + 1, m = Math.floor(Math.random() * 5) + 1, n = Math.floor(Math.random() * 5) + 1;
    let areaEBD = b * m * (Math.floor(Math.random() * 10) + 1);
    let areaABC = areaEBD * (a + b) * (m + n) / (b * m);
    areaABC = Math.round(areaABC);
    correctAnswer = [areaABC + ''];
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Ex = (b * Ax + a * Bx) / (a + b);
    let Ey = (b * Ay + a * By) / (a + b);
    let Dx = (n * Ax + m * Cx) / (m + n);
    let Dy = (n * Ay + m * Cy) / (m + n);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${svgWidth}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${svgWidth}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ex}" y1="${Ey}" x2="${Dx}" y2="${Dy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
            <circle cx="${Dx}" cy="${Dy}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Ex-labelOffset}" y="${Ey}" text-anchor="middle">E</text>
            <text x="${Dx+labelOffset}" y="${Dy}" text-anchor="middle">D</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，<br>
        AE将AB分成两段，\\( AE:EB = ${a}:${b} \\)，<br>
        AD将AC分成两段，\\( AD:DC = ${m}:${n} \\)，<br>
        已知\\( S_1 = ${areaEBD} \\)，求\\( S_{\\triangle ABC} \\)。
        <div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel6Question() {
    // 生成AG:GB = a:b (化简后的比例)
    let a = Math.floor(Math.random() * 3) + 1;
    let b = Math.floor(Math.random() * 3) + 1;
    // 生成AF:FD = m:n (化简后的比例)
    let m = Math.floor(Math.random() * 3) + 1;
    let n = Math.floor(Math.random() * 3) + 1;

    // 生成一个随机的三角形BDO面积
    let areaBDO = (Math.floor(Math.random() * 4) + 1) * b * n;  // b*n的倍数
    // 根据模型，计算四边形ABCD的面积
    // S_ABCD = S_BDO * (a*(m+n) + b*n + b*m) / (b*n)
    let areaABCD = areaBDO * (a * (m + n) + b * n + b * m) / (b * n);
    areaABCD = Math.round(areaABCD);

    // 矩形ABCD的顶点，按图片顺序：A(左下)、B(右下)、C(右上)、D(左上)
    const pointA = {x: 40, y: 260};
    const pointB = {x: 360, y: 260};
    const pointC = {x: 360, y: 40};
    const pointD = {x: 40, y: 40};

    // G在AB上，AG:GB = a:b
    const pointG = {
        x: (b * pointA.x + a * pointB.x) / (a + b),
        y: (b * pointA.y + a * pointB.y) / (a + b)
    };
    // F在AD上，AF:FD = m:n
    const pointF = {
        x: (n * pointA.x + m * pointD.x) / (m + n),
        y: (n * pointA.y + m * pointD.y) / (m + n)
    };
    // E为DB与AF交点
    function getLineIntersection(p1, p2, p3, p4) {
        const a1 = p2.y - p1.y;
        const b1 = p1.x - p2.x;
        const c1 = a1 * p1.x + b1 * p1.y;
        const a2 = p4.y - p3.y;
        const b2 = p3.x - p4.x;
        const c2 = a2 * p3.x + b2 * p3.y;
        const det = a1 * b2 - a2 * b1;
        if (det === 0) return {x: NaN, y: NaN};
        return {
            x: (b2 * c1 - b1 * c2) / det,
            y: (a1 * c2 - a2 * c1) / det
        };
    }
    const pointE = getLineIntersection(pointD, pointB, pointA, pointF);
    // O为BF与DG的交点
    const pointO = getLineIntersection(pointB, pointF, pointD, pointG);

    // 偏移参数
    const labelOffset = 15;
    // 创建SVG图形
    const svg = `
    <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <g id="shapeGroup">
            <polygon points="${pointA.x},${pointA.y} ${pointB.x},${pointB.y} ${pointC.x},${pointC.y} ${pointD.x},${pointD.y}" fill="#fff" stroke="#000" stroke-width="2" vector-effect="non-scaling-stroke"/>
            <polygon points="${pointD.x},${pointD.y} ${pointB.x},${pointB.y} ${pointO.x},${pointO.y}" fill="#e6ffe6" stroke="none"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointF.x}" y2="${pointF.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointD.x}" y1="${pointD.y}" x2="${pointB.x}" y2="${pointB.y}" stroke="#000" stroke-width="1.5" stroke-dasharray="4,4" vector-effect="non-scaling-stroke"/>
            <line x1="${pointD.x}" y1="${pointD.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointB.x}" y1="${pointB.y}" x2="${pointF.x}" y2="${pointF.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${pointA.x}" cy="${pointA.y}" r="4" fill="#000"/>
            <circle cx="${pointB.x}" cy="${pointB.y}" r="4" fill="#000"/>
            <circle cx="${pointC.x}" cy="${pointC.y}" r="4" fill="#000"/>
            <circle cx="${pointD.x}" cy="${pointD.y}" r="4" fill="#000"/>
            <circle cx="${pointF.x}" cy="${pointF.y}" r="4" fill="#000"/>
            <circle cx="${pointG.x}" cy="${pointG.y}" r="4" fill="#000"/>
            <circle cx="${pointO.x}" cy="${pointO.y}" r="2" fill="#000"/>
        </g>
        <g id="labelsGroup" font-size="16" font-family="Arial" fill="#222" font-weight="bold">
            <text x="${pointA.x-10}" y="${pointA.y+15}" text-anchor="middle">A</text>
            <text x="${pointB.x+10}" y="${pointB.y+15}" text-anchor="middle">B</text>
            <text x="${pointC.x+10}" y="${pointC.y-5}" text-anchor="middle">C</text>
            <text x="${pointD.x-10}" y="${pointD.y-5}" text-anchor="middle">D</text>
            <text x="${pointF.x-10}" y="${pointF.y+5}" text-anchor="middle">F</text>
            <text x="${pointG.x}" y="${pointG.y+20}" text-anchor="middle">G</text>
            <text x="${pointO.x-10}" y="${pointO.y+10}" text-anchor="middle">O</text>
        </g>
        <g id="markersGroup" font-size="14" font-family="Arial" fill="#666">
            <text x="${(pointB.x + pointD.x + pointO.x)/3}" y="${(pointB.y + pointD.y + pointO.y)/3}" text-anchor="middle">S=${areaBDO}</text>
        </g>
    </svg>
    `;
    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，矩形ABCD中，\\
        AG:GB = ${a}:${b}，AF:FD = ${m}:${n}，\\
        S_{\\triangle BDO} = ${areaBDO}平方厘米，\\
        则S_{ABCD} = \\_平方厘米。
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
        <div style="text-align:center;margin-top:5px;">\\( S_{\\triangle BDO} = ${areaBDO} \\)</div>
    </div>
    `;
    correctAnswer = [`${areaABCD}`];
    return question;
}

function generateLevel7Question() {
    // 直接复用前6种题型的SVG生成函数，已全部优化
    const levels = [generateLevel1Question, generateLevel2Question, generateLevel3Question, generateLevel4Question, generateLevel5Question, generateLevel6Question];
    return levels[Math.floor(Math.random() * levels.length)]();
}

// ===== F05中考模型题型生成函数（完整版） =====
function generateF05Level1Question() {
    const pythagoreanTriplets = [
        [6, 8, 10], [12, 16, 20], [5, 12, 13], [9, 12, 15], [15, 20, 25], [10, 24, 26], [8, 15, 17]
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let AB = a;
    let ratio = Math.random() * 0.6 + 0.2;
    let AM = Math.round(b * ratio);
    let BN = b - AM;
    let minValue = Math.sqrt(AB*AB + (AM+BN)*(AM+BN));
    const width = 420, height = Math.max(AM,BN)*40;
    const Ax = 210-AM*10, Ay = height/2;
    const Bx = 210+BN*10, By = height/2;
    const Mx = Ax, My = Ay - AM*15;
    const Nx = Bx, Ny = By - BN*15;
    const Px = (BN*Ax + AM*Bx) / (b), Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+12}" font-family="serif" font-size="22">A</text>
        <text x="${Bx+16}" y="${By+12}" font-family="serif" font-size="22">B</text>
        <text x="${Mx-16}" y="${My-12}" font-family="serif" font-size="22">M</text>
        <text x="${Nx+16}" y="${Ny-12}" font-family="serif" font-size="22">N</text>
        <text x="${(Ax+Bx)/2}" y="${Ay+36}" text-anchor="middle" font-family="serif" font-size="20">AB = ${AB}</text>
        <text x="${Ax-36}" y="${(Ay+My)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-90,${Ax-36},${(Ay+My)/2})">${AM}</text>
        <text x="${Bx+36}" y="${(By+Ny)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-90,${Bx+36},${(By+Ny)/2})">${BN}</text>
    </svg>`;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\
        其中AM = ${AM}，BN = ${BN}，AB = ${AB}，\\
        求|PM|+|PN|的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${minValue}`, `${c}`];
    return question;
}

function generateF05Level2Question() {
    const pythagoreanTriplets = [
        [6, 8, 10], [12, 16, 20], [5, 12, 13], [9, 12, 15], [15, 20, 25], [10, 24, 26], [8, 15, 17]
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let AB = b;
    let BN = Math.floor(Math.random() * 10) + 5;
    let AM = BN + a;
    let maxDifference = c;
    // 计算图形中的位置
    const width = 420;
    const height = Math.max(AM,BN)*40;
    const Ax = 30;
    const Ay = height/2;
    const Bx = 30+AB*10;
    const By = height/2;
    const Mx = Ax;
    const My = Ay - AM*10;
    const Nx = Bx;
    const Ny = By - BN*10;
    const Px = (Ax + Bx) / 2;
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Mx}" y1="${My}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+12}" font-family="serif" font-size="22">A</text>
        <text x="${Bx+16}" y="${By+12}" font-family="serif" font-size="22">B</text>
        <text x="${Mx-16}" y="${My-12}" font-family="serif" font-size="22">M</text>
        <text x="${Nx+16}" y="${Ny-12}" font-family="serif" font-size="22">N</text>
        <text x="${(Ax+Bx)/2}" y="${Ay+36}" text-anchor="middle" font-family="serif" font-size="20">AB = ${AB}</text>
        <text x="${Ax-10}" y="${(Ay+My)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-0,${Ax-10},${(Ay+My)/2})">${AM}</text>
        <text x="${Bx+10}" y="${(By+Ny)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-0,${Bx+10},${(By+Ny)/2})">${BN}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\\\
        其中AM = ${AM}，BN = ${BN}，AB = ${AB}，\\\\
        已知AM - BN = ${a}，\\\\
        求||PM|-|PN||的最大值。\\\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${c}`,];
    return question;
}

function generateF05Level3Question() {
    // 一线三直角
    const pythagoreanTriplets = [
        [4, 6, 3, 8], [4, 6, 2, 12], [4, 6, 8, 3], [4, 6, 12, 2], [4, 3, 12, 1], [4, 3, 2, 6], [6, 3, 2, 9], [6, 3, 9, 2],
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], m = selectedTriplet[2], n = selectedTriplet[3];
    let AB = m + n;
    let AM = a;
    let BN = b;
    const width = 420;
    const height = 400;
    const Ax = 30;
    const Ay = height/2;
    const Bx = 30+AB*20;
    const By = height/2;
    const Mx = Ax;
    const My = Ay - a*20;
    const Nx = Bx;
    const Ny = By - b*20;
    const Px = (m*Ax + n*Bx) / (n+m);
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="1"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Mx}" y1="${My}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+24}" font-family="serif" font-size="22">A(0,0)</text>
        <text x="${Bx+16}" y="${By+24}" font-family="serif" font-size="22">B(${m+n},${b})</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\
        其中AM = ${a}，BN = ${b}，AB = ${m+n}，\\
        求AP、BP的值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${m},${n}`, `${n},${m}`];
    return question;
}

function generateF05Level4Question() {
    // 胡不归
    const pythagoreanTriplets = [
        [3, 4, 5], [4, 3, 5], [5, 12, 13],
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let m = Math.floor(Math.random() * 2) + 1;
    let n = Math.floor(Math.random() * 2) + 1;
    const width = 420*(c*m+a*n)/14;
    const height = 400*b*n/14;
    const Ax = 30;
    const Ay = height/1.6;
    const Bx = 30+(c*m+a*n)*10;
    const By = height/1.6-(b*n)*10;
    const Px = 30+(c*m)*10;
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Ax}" y2="${Ay}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Bx}" y2="${By}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+24}" font-family="serif" font-size="22">A(0,0)</text>
        <text x="${Bx+16}" y="${By+24}" font-family="serif" font-size="22">B(${c*m+a*n},${b*n})</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，点A坐标(0,0)，点B坐标(${c*m+a*n},${b*n})，\\ P是直线AC上的一个动点，\\
        求BP+\\frac{${a}}{${c}}PA的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${m*b+n*a}`];
    return question;
}

function generateF05Level5Question() {
    // 鸟头模型1
    let a = Math.floor(Math.random() * 5) + 1;
    let b = Math.floor(Math.random() * 5) + 1;
    let m = Math.floor(Math.random() * 5) + 1;
    let n = Math.floor(Math.random() * 5) + 1;
    let divisor_ab = gcd(a, b);
    let divisor_mn = gcd(m, n);
    let simplified_a = a / divisor_ab;
    let simplified_b = b / divisor_ab;
    let simplified_m = m / divisor_mn;
    let simplified_n = n / divisor_mn;
    let areaFactor = Math.floor(Math.random() * 10) + 1;
    let areaAED = a * m * areaFactor;
    let areaABC = areaAED * (a + b) * (m + n) / (a * m);
    areaABC = Math.round(areaABC);
    const width = 200;
    const height = 150;
    const Ax = 100;
    const Ay = 20;
    const Bx = 20;
    const By = 130;
    const Cx = 180;
    const Cy = 130;
    const eRatio = a / (a + b);
    const Ex = Ax - (Ax - Bx) * eRatio;
    const Ey = Ay + (By - Ay) * eRatio;
    const dRatio = m / (m + n);
    const Dx = Ax - (Ax - Cx) * dRatio;
    const Dy = Ay + (Cy - Ay) * dRatio;
    const centroidAEDx = (Ax + Ex + Dx) / 3;
    const centroidAEDy = (Ay + Ey + Dy) / 3;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="none" stroke="black" stroke-width="1.5"/>
        <polygon points="${Ax},${Ay} ${Ex},${Ey} ${Dx},${Dy}" fill="#e6f2ff" stroke="black" stroke-width="1.5"/>
        <circle cx="${Ex}" cy="${Ey}" r="3" fill="black"/>
        <circle cx="${Dx}" cy="${Dy}" r="3" fill="black"/>
        <text x="${Ax}" y="${Ay-5}" text-anchor="middle" font-family="serif" font-size="16">A</text>
        <text x="${Bx-5}" y="${By+5}" text-anchor="middle" font-family="serif" font-size="16">B</text>
        <text x="${Cx+5}" y="${Cy+5}" text-anchor="middle" font-family="serif" font-size="16">C</text>
        <text x="${Ex-5}" y="${Ey-5}" text-anchor="middle" font-family="serif" font-size="16">E</text>
        <text x="${Dx+5}" y="${Dy-5}" text-anchor="middle" font-family="serif" font-size="16">D</text>
        <text x="${centroidAEDx}" y="${centroidAEDy}" text-anchor="middle" font-family="serif" font-size="14">S₁=${areaAED}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        在\\triangle ABC中，E是AB边上的点，D是AC边上的点，\\
        且AE:EB = ${simplified_a}:${simplified_b}，AD:DC = ${simplified_m}:${simplified_n}，\\
        已知\\triangle AED的面积S_1=${areaAED}，\\
        求\\triangle ABC的面积S\\triangle ABC。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateF05Level6Question() {
    // 鸟头模型2
    let a = Math.floor(Math.random() * 5) + 1;
    let b = Math.floor(Math.random() * 5) + 1;
    let m = Math.floor(Math.random() * 5) + 1;
    let n = Math.floor(Math.random() * 5) + 1;
    let divisor_ab = gcd(a, b);
    let divisor_mn = gcd(m, n);
    let simplified_a = a / divisor_ab;
    let simplified_b = b / divisor_ab;
    let simplified_m = m / divisor_mn;
    let simplified_n = n / divisor_mn;
    let areaFactor = Math.floor(Math.random() * 10) + 1;
    let areaEBD = b * m * areaFactor;
    let areaABC = areaEBD * (a + b) * (m + n) / (b * m);
    areaABC = Math.round(areaABC);
    const width = 200;
    const height = 150;
    const Ax = 100;
    const Ay = 20;
    const Bx = 20;
    const By = 130;
    const Cx = 180;
    const Cy = 130;
    const eRatio = a / (a + b);
    const Ex = Ax - (Ax - Bx) * eRatio;
    const Ey = Ay + (By - Ay) * eRatio;
    const dRatio = m / (m + n);
    const Dx = Ax - (Ax - Cx) * dRatio;
    const Dy = Ay + (Cy - Ay) * dRatio;
    const centroidEBDx = (Ex + Bx + Dx) / 3;
    const centroidEBDy = (Ey + By + Dy) / 3;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="none" stroke="black" stroke-width="1.5"/>
        <polygon points="${Ex},${Ey} ${Bx},${By} ${Dx},${Dy}" fill="#e6f2ff" stroke="black" stroke-width="1.5"/>
        <circle cx="${Ex}" cy="${Ey}" r="3" fill="black"/>
        <circle cx="${Dx}" cy="${Dy}" r="3" fill="black"/>
        <text x="${Ax}" y="${Ay-5}" text-anchor="middle" font-family="serif" font-size="16">A</text>
        <text x="${Bx-5}" y="${By+5}" text-anchor="middle" font-family="serif" font-size="16">B</text>
        <text x="${Cx+5}" y="${Cy+5}" text-anchor="middle" font-family="serif" font-size="16">C</text>
        <text x="${Ex-5}" y="${Ey-5}" text-anchor="middle" font-family="serif" font-size="16">E</text>
        <text x="${Dx+5}" y="${Dy-5}" text-anchor="middle" font-family="serif" font-size="16">D</text>
        <text x="${centroidEBDx}" y="${centroidEBDy}" text-anchor="middle" font-family="serif" font-size="14">S₁=${areaEBD}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        在\\triangle ABC中，E是AB边上的点，D是AC边上的点，\\
        且AE:EB = ${simplified_a}:${simplified_b}，AD:DC = ${simplified_m}:${simplified_n}，\\
        已知\\triangle EBD的面积S_1=${areaEBD}，\\
        求\\triangle ABC的面积S\\triangle ABC。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateF05Level7Question() {
    // 阿氏圆
    const configurations = [
        { r: 2, C: [1, 0], B: [4, 0], ratio: 1/2, ratioText: "\\frac{1}{2}" },
        { r: 3, C: [1, 0], B: [9, 0], ratio: 1/3, ratioText: "\\frac{1}{3}" }
    ];
    const config = configurations[Math.floor(Math.random() * configurations.length)];
    const pythagoreanTriplets = [
        {a: 3, b: 4, c: 5},
        {a: 5, b: 12, c: 13},
        {a: 6, b: 8, c: 10},
        {a: 8, b: 15, c: 17}
    ];
    const triplet = pythagoreanTriplets[Math.floor(Math.random() * pythagoreanTriplets.length)];
    const r = config.r;
    const C = config.C;
    const B = config.B;
    const A = [C[0] + triplet.a, triplet.b];
    const Px = Math.sqrt(r*r/2);
    const Py = Math.sqrt(r*r/2);
    const scale = 25;
    const svgWidth = 500;
    const svgHeight = 450;
    const offsetX = Math.round(svgWidth * 0.5);
    const offsetY = 250;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(-${svgWidth/4}, ${svgHeight/4})">
            <line x1="0" y1="${offsetY}" x2="${svgWidth}" y2="${offsetY}" stroke="black" stroke-width="1"/>
            <line x1="${offsetX}" y1="0" x2="${offsetX}" y2="${svgHeight}" stroke="black" stroke-width="1"/>
            <text x="${offsetX-20}" y="${offsetY+20}" font-family="serif" font-size="16">O</text>
            <circle cx="${offsetX}" cy="${offsetY}" r="${r * scale}" fill="none" stroke="blue" stroke-width="1.5"/>
            <circle cx="${offsetX + C[0] * scale}" cy="${offsetY - C[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + C[0] * scale - 20}" y="${offsetY - C[1] * scale + 20}" font-family="serif" font-size="16">C(${C[0]},${C[1]})</text>
            <circle cx="${offsetX + B[0] * scale}" cy="${offsetY - B[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + B[0] * scale - 10}" y="${offsetY - B[1] * scale + 20}" font-family="serif" font-size="16">B(${B[0]},${B[1]})</text>
            <circle cx="${offsetX + A[0] * scale}" cy="${offsetY - A[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + A[0] * scale - 10}" y="${offsetY - A[1] * scale - 10}" font-family="serif" font-size="16">A(${A[0]},${A[1]})</text>
            <circle cx="${offsetX + Px * scale}" cy="${offsetY - Py * scale}" r="4" fill="red"/>
            <text x="${offsetX + Px * scale - 10}" y="${offsetY - Py * scale - 10}" font-family="serif" font-size="16">P</text>
            <line x1="${offsetX + C[0] * scale}" y1="${offsetY - C[1] * scale}"
                  x2="${offsetX + A[0] * scale}" y2="${offsetY - A[1] * scale}"
                  stroke="gray" stroke-width="1" stroke-dasharray="4,4"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + A[0] * scale}" y2="${offsetY - A[1] * scale}"
                  stroke="red" stroke-width="1.5"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + B[0] * scale}" y2="${offsetY - B[1] * scale}"
                  stroke="blue" stroke-width="1.5"/>
            <line x1="${offsetX}" y1="${offsetY}"
                  x2="${offsetX + Px * scale}" y2="${offsetY - Py * scale}"
                  stroke="purple" stroke-width="1.5"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + C[0] * scale}" y2="${offsetY - C[1] * scale}"
                  stroke="purple" stroke-width="1.5"/>
            <text x="${offsetX - 100}" y="50" font-family="serif" font-size="16">圆C: x² + y² = ${r*r}</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，点P在圆C:x^2+y^2=${r*r}上，\\
        C(${C[0]},${C[1]})，B(${B[0]},${B[1]})，A(${A[0]},${A[1]})，\\
        求AP+${config.ratioText}PB的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;" id="svgContainer">${svg}</div>
    </div>
    `;
    const minValue = triplet.c;
    correctAnswer = [`${minValue}`];
    return question;
}

function generateF05Level8Question() {
    // 综合测试
    const levelFunctions = [
        generateF05Level1Question,
        generateF05Level2Question,
        generateF05Level3Question,
        generateF05Level4Question,
        generateF05Level5Question,
        generateF05Level6Question,
        generateF05Level7Question
    ];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];
    return selectedFunction();
}

// ========== 二级分组结构 ===========
const typeGroups = [
  {
    group: '燕尾模型类',
    types: [
      { name: '01燕尾模型', generator: generateLevel1Question },
      { name: '02燕尾模型两外比', generator: generateLevel2Question },
      { name: '03燕尾模型一内一外比', generator: generateLevel3Question },
      { name: '04燕尾模型两内比', generator: generateLevel4Question },
      { name: '05鸟头模型', generator: generateLevel5Question },
      { name: '06燕尾模型矩形面积', generator: generateLevel6Question },
      { name: '07综合测试', generator: generateLevel7Question },
    ]
  },
  {
    group: '中考模型类',
    types: [
      { name: '01将军饮马和最小值', generator: generateF05Level1Question },
      { name: '02将军饮马差最大值', generator: generateF05Level2Question },
      { name: '03一线三直角', generator: generateF05Level3Question },
      { name: '04胡不归', generator: generateF05Level4Question },
      { name: '05鸟头模型1', generator: generateF05Level5Question },
      { name: '06鸟头模型2', generator: generateF05Level6Question },
      { name: '07阿氏圆', generator: generateF05Level7Question },
      { name: '08综合测试', generator: generateF05Level8Question },
    ]
  }
];

// ========== 分组选择栏渲染 ===========
function renderTypeSelect() {
  const container = document.getElementById('typeSelect');
  container.innerHTML = '';
  typeGroups.forEach((group, gIdx) => {
    const groupDiv = document.createElement('div');
    groupDiv.style.marginBottom = '18px';
    // 分组标题
    const groupTitle = document.createElement('div');
    groupTitle.style.fontWeight = 'bold';
    groupTitle.style.fontSize = '16px';
    groupTitle.style.color = '#2196F3';
    groupTitle.style.marginBottom = '6px';
    groupTitle.style.cursor = 'pointer';
    groupTitle.textContent = group.group;
    groupDiv.appendChild(groupTitle);
    // 题型项容器
    const itemsContainer = document.createElement('div');
    itemsContainer.style.display = 'none'; // 默认隐藏
    group.types.forEach((type, tIdx) => {
      const idx = `${gIdx}_${tIdx}`;
      const item = document.createElement('div');
      item.className = 'type-item';
      item.style.display = 'none'; // 默认隐藏
      item.innerHTML = `
        <input type="checkbox" id="type${idx}">
        <label for="type${idx}">${type.name}</label>
        <span>数量</span>
        <input type="number" id="num${idx}" min="1" max="50" value="3">
      `;
      itemsContainer.appendChild(item);
    });
    groupDiv.appendChild(itemsContainer);
    // 分组标题点击展开/收起
    groupTitle.addEventListener('click', function() {
      if (itemsContainer.style.display === 'none') {
        itemsContainer.style.display = '';
        Array.from(itemsContainer.children).forEach(e => e.style.display = '');
      } else {
        itemsContainer.style.display = 'none';
        Array.from(itemsContainer.children).forEach(e => e.style.display = 'none');
      }
    });
    container.appendChild(groupDiv);
  });
}

// ========== 生成所有题目 ===========
function generateAllQuestions() {
  const preview = document.getElementById('previewArea');
  let allQAs = [];
  typeGroups.forEach((group, gIdx) => {
    group.types.forEach((type, tIdx) => {
      const idx = `${gIdx}_${tIdx}`;
      const checked = document.getElementById(`type${idx}`).checked;
      const num = parseInt(document.getElementById(`num${idx}`).value);
      if (checked && num > 0) {
        for (let i = 0; i < num; i++) {
          let correctAnswer = [];
          window.correctAnswer = correctAnswer;
          const qHtml = type.generator();
          const aText = (window.correctAnswer || []).join(' 或 ');
          allQAs.push({
            group: group.group,
            type: type.name,
            qHtml,
            aText
          });
        }
      }
    });
  });
  if (allQAs.length === 0) {
    preview.innerHTML = '<div style="text-align:center;color:#888;">请至少选择一个题型并设置题目数量</div>';
    return;
  }
  let html = '<table class="qa-table"><thead><tr><th>分组</th><th>题型</th><th>题目</th><th>答案</th></tr></thead><tbody>';
  allQAs.forEach((qa, idx) => {
    html += `<tr><td>${qa.group}</td><td>${qa.type}</td><td>${qa.qHtml}</td><td>\\(${qa.aText}\\)</td></tr>`;
  });
  html += '</tbody></table>';
  preview.innerHTML = html;
  MathJax.typesetPromise([preview]);
}

// 初始化
renderTypeSelect();
</script>
</body>
</html>

