<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>玖数学题库</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script id="MathJax-script" async src=".\mathjax\mathjax\es5\tex-mml-chtml.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f8f8f8;
        }
        .main-layout {
            display: flex;
            align-items: flex-start;
            width: 100%;
            min-height: 100vh;
            background: #f8f8f8;
        }
        .sidebar {
            width: 220px;
            min-width: 180px;
            flex-shrink: 0;
            background: #f6faff;
            border-radius: 8px;
            padding: 18px 10px 18px 10px;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            box-sizing: border-box;
            margin: 30px 0 30px 30px;
            height: 100vh;
            position: relative;
            max-height: 100vh;
            /* 让内容从顶部开始 */
            justify-content: flex-start;
        }
        .type-select {
            display: flex;
            flex-direction: column;
            gap: 14px;
            margin-bottom: 30px;
            overflow-y: auto;
            min-height: 60px;
            /* 动态最大高度，减去actions高度和padding */
            max-height: calc(100vh - 120px);
        }
        .type-item {
            background: #eaf4fb;
            border-radius: 6px;
            padding: 10px 10px 10px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .type-item input[type="number"] {
            width: 50px;
            padding: 2px 4px;
        }
        .sidebar .actions {
            margin-top: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: static;
            background: none;
            z-index: 1;
            padding-bottom: 0;
            box-shadow: none;
        }
        .sidebar .actions button {
            width: 100%;
            margin: 0;
            padding: 10px 30px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            background: #2196F3;
            color: #fff;
            cursor: pointer;
        }
        .sidebar .actions button:hover {
            background: #1769aa;
        }
        .container {
            max-width: 1200px;
            margin: 30px auto 30px 0;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px #ddd;
            padding: 30px 30px 50px 30px;
            flex: 1;
            min-width: 0;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-height: none;
        }
        .preview-area {
            flex: 1 1 auto;
            min-width: 0;
            min-height: 200px;
            overflow-y: auto;
            overflow-x: auto;
            max-height: calc(100vh - 180px); /* 视口高度-顶部边距，内容区溢出时内部滚动 */
        }
        .qa-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            table-layout: auto;
            word-break: break-all;
        }
        .qa-table th, .qa-table td {
            border: 1px solid #ccc;
            padding: 10px;
            vertical-align: top;
            word-break: break-word;
        }
        .qa-table th {
            background: #f4f4f4;
        }
        @media print {
            body, .container {
                background: #fff !important;
                box-shadow: none !important;
            }
            .actions, .type-select, .sidebar, h2 {
                display: none !important;
            }
            .preview-area {
                margin: 0;
                padding: 0;
            }
            .qa-table th, .qa-table td {
                font-size: 15px;
                padding: 8px;
            }
        }
        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
                align-items: stretch;
            }
            .sidebar {
                width: 100%;
                min-width: 0;
                margin: 0 0 20px 0;
                border-radius: 0;
                flex-direction: row;
                align-items: flex-start;
                padding: 10px 0 0 0;
                max-height: 100vh;
                height: 100vh;
                justify-content: flex-start;
            }
            .type-select {
                flex: 1;
                margin-bottom: 0;
                max-height: calc(100vh - 100px);
            }
            .sidebar .actions {
                position: static;
                left: auto;
                right: auto;
                bottom: auto;
                width: auto;
                background: none;
                box-shadow: none;
                z-index: 1;
                border-radius: 0;
                padding: 0;
                margin-left: 0;
            }
            .container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
                min-height: 400px;
                max-height: none;
                height: 100vh;
            }
            .preview-area {
                max-height: calc(100vh - 140px);
            }
        }
    </style>
</head>
<body>
<div class="main-layout">
    <div class="sidebar">
        <div class="actions">
            <button onclick="generateAllQuestions()">生成题目</button>
            <button onclick="window.print()">打印/导出PDF</button>
        </div>
        <div class="type-select" id="typeSelect"></div>
    </div>
    <div class="container">
        <h2>玖数学题库</h2>
        <div class="preview-area" id="previewArea">
            <div style="text-align:center;color:#888;">请先选择题型和数量，点击"生成题目"</div>
        </div>
    </div>
</div>
<script>
// 题型配置
// const difficultyNames = [
//     "01燕尾模型", 
//     "02燕尾模型两外比", 
//     "03燕尾模型一内一外比",
//     "04燕尾模型两内比",
//     "05鸟头模型",
//     "06燕尾模型矩形面积",
//     "07综合测试"
// ];

// 题目生成函数映射
// const questionGenerators = [
//     generateLevel1Question,
//     generateLevel2Question,
//     generateLevel3Question,
//     generateLevel4Question,
//     generateLevel5Question,
//     generateLevel6Question,
//     generateLevel7Question
// ];

// 生成题型选择区
function renderTypeSelect() {
    const container = document.getElementById('typeSelect');
    container.innerHTML = '';
    typeGroups.forEach((group, gIdx) => {
        const groupDiv = document.createElement('div');
        groupDiv.style.marginBottom = '18px';
        // 分组标题
        const groupTitle = document.createElement('div');
        groupTitle.style.fontWeight = 'bold';
        groupTitle.style.fontSize = '16px';
        groupTitle.style.color = '#2196F3';
        groupTitle.style.marginBottom = '6px';
        groupTitle.style.cursor = 'pointer';
        groupTitle.textContent = group.group;
        groupDiv.appendChild(groupTitle);
        // 题型项容器
        const itemsContainer = document.createElement('div');
        itemsContainer.style.display = 'none'; // 默认隐藏
        group.types.forEach((type, tIdx) => {
            const idx = `${gIdx}_${tIdx}`;
            const item = document.createElement('div');
            item.className = 'type-item';
            item.style.display = 'none'; // 默认隐藏
            item.innerHTML = `
                <input type="checkbox" id="type${idx}">
                <label for="type${idx}">${type.name}</label>
                <span>数量</span>
                <input type="number" id="num${idx}" min="1" max="50" value="3">
            `;
            itemsContainer.appendChild(item);
        });
        groupDiv.appendChild(itemsContainer);
        // 分组标题点击展开/收起
        groupTitle.addEventListener('click', function() {
            if (itemsContainer.style.display === 'none') {
                itemsContainer.style.display = '';
                Array.from(itemsContainer.children).forEach(e => e.style.display = '');
            } else {
                itemsContainer.style.display = 'none';
                Array.from(itemsContainer.children).forEach(e => e.style.display = 'none');
            }
        });
        container.appendChild(groupDiv);
    });
}

// 生成所有题目
function generateAllQuestions() {
    const preview = document.getElementById('previewArea');
    let allQAs = [];
    // difficultyNames.forEach((name, idx) => {
    //     const checked = document.getElementById(`type${idx}`).checked;
    //     const num = parseInt(document.getElementById(`num${idx}`).value);
    //     if (checked && num > 0) {
    //         for (let i = 0; i < num; i++) {
    //             let correctAnswer = [];
    //             window.correctAnswer = correctAnswer; // 兼容原函数
    //             const qHtml = questionGenerators[idx]();
    //             const aText = (window.correctAnswer || []).join(' 或 ');
    //             allQAs.push({
    //                 type: name,
    //                 qHtml,
    //                 aText
    //             });
    //         }
    //     }
    // });
    if (allQAs.length === 0) {
        preview.innerHTML = '<div style="text-align:center;color:#888;">请至少选择一个题型并设置题目数量</div>';
        return;
    }
    let html = '<table class="qa-table"><thead><tr><th>题型</th><th>题目</th><th>答案</th></tr></thead><tbody>';
    allQAs.forEach((qa, idx) => {
        html += `<tr><td>${qa.type}</td><td>${qa.qHtml}</td><td>\(${qa.aText}\)</td></tr>`;
    });
    html += '</tbody></table>';
    preview.innerHTML = html;
    MathJax.typesetPromise([preview]);
}

// 公因数
function gcd(x, y) {
    while (y != 0) {
        let temp = y;
        y = x % y;
        x = temp;
    }
    return x;
}

// 题目生成函数
function generateLevel1Question() {
     // 生成随机比例
    let ratio1 = Math.floor(Math.random() * 5) + 1;  // 1 to 5
    let ratio2 = Math.floor(Math.random() * 5) + 1;  // 1 to 5

    // 计算最大公约数
    let divisor = gcd(ratio1, ratio2);

    // 将比例化为最简比
    let simplifiedRatio1 = ratio1 / divisor;
    let simplifiedRatio2 = ratio2 / divisor;

    // 生成随机高度因子，确保面积为整数
    let heightFactor = Math.floor(Math.random() * 10) + 1;  // 1 to 10

    // 计算面积
    let S1 = ratio1 * heightFactor;
    let S2 = ratio2 * heightFactor;

    // 计算图形中的位置
    const totalWidth = 160;
    const totalRatio = ratio1 + ratio2;
    const leftWidth = (ratio1 / totalRatio) * totalWidth;
    const dPosition = 20 + leftWidth; // x-coordinate of point D

    // 计算点E的位置 - E是AD上的任意点
    // 随机选择E在AD上的位置，距离A的比例为0.3到0.7之间
    const eRatio = 0.3 + Math.random() * 0.4; // E在AD上的位置比例
    const ePositionX = 100 - (100 - dPosition) * eRatio; // E的x坐标
    const ePositionY = 20 + (130 - 20) * eRatio; // E的y坐标

    // 计算三角形重心位置用于标注面积
    const leftCentroidX = (100 + 20 + ePositionX) / 3;
    const leftCentroidY = (20 + 130 + ePositionY) / 3;

    const rightCentroidX = (100 + ePositionX + 180) / 3;
    const rightCentroidY = (20 + 130 + ePositionY) / 3;

    // 创建SVG图形（优化版，完全按规范）
    const svg = `
    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
        <!-- 网格组 -->
        <g id="gridGroup">
            <line x1="20" y1="40" x2="180" y2="40" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="20" y1="85" x2="180" y2="85" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 坐标轴组 -->
        <g id="axisGroup">
            <line x1="20" y1="130" x2="180" y2="130" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 图形组 -->
        <g id="shapeGroup">
            <polygon points="100,20 20,130 ${ePositionX},${ePositionY}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
            <polygon points="100,20 ${ePositionX},${ePositionY} 180,130" fill="#e6ffe6" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 辅助线组 -->
        <g id="auxLineGroup">
            <line x1="100" y1="20" x2="${dPosition}" y2="130" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <!-- 点组 -->
        <g id="pointsGroup">
            <circle cx="100" cy="20" r="6" fill="#4CAF50"/>
            <circle cx="20" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="180" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="${dPosition}" cy="130" r="6" fill="#4CAF50"/>
            <circle cx="${ePositionX}" cy="${ePositionY}" r="6" fill="#4CAF50"/>
        </g>
        <!-- 标签组 -->
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="100" y="10" text-anchor="middle">A</text>
            <text x="10" y="145" text-anchor="middle">B</text>
            <text x="190" y="145" text-anchor="middle">C</text>
            <text x="${dPosition}" y="145" text-anchor="middle">D</text>
            <text x="${ePositionX+15}" y="${ePositionY+15}" text-anchor="middle">E</text>
        </g>
        <!-- 面积标注 -->
        <g id="markersGroup" font-size="14" font-family="Arial" fill="#666">
            <text x="${leftCentroidX}" y="${leftCentroidY}" text-anchor="middle">S₁=${S1}</text>
            <text x="${rightCentroidX}" y="${rightCentroidY}" text-anchor="middle">S₂=?</text>
        </g>
    </svg>
    `;

    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        在△ABC中，AD将底边BC分成两段，<br>
        \\( BD:DC = ${simplifiedRatio1}:${simplifiedRatio2} \\)，E是AD上的一点，<br>
        \\( S_1 = ${S1} \\)，求右边部分的面积 \\( S_2 \\)。
        <div style="margin-top: 18px;">${svg}</div>
    </div>
    `;

    // 设置正确答案
    correctAnswer = [
        `${S2}`
    ];

    return question;
}

function generateLevel2Question() {
    // 随机生成比值
    let a = Math.floor(Math.random() * 4) + 1, b = Math.floor(Math.random() * 4) + 1, c = Math.floor(Math.random() * 4) + 1, d = Math.floor(Math.random() * 4) + 1;
    let gcdAB = gcd(a, b), gcdCD = gcd(c, d);
    let sa = a / gcdAB, sb = b / gcdAB, sc = c / gcdCD, sd = d / gcdCD;
    let e = b * d, f = a * c, gcdEF = gcd(e, f);
    let se = e / gcdEF, sf = f / gcdEF;
    correctAnswer = [`${sf}:${se}`];
    // SVG参数
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Gx = (sb * Ax + sa * Bx) / (sa + sb);
    let Gy = (sb * Ay + sa * By) / (sa + sb);
    let Dx = (sd * Bx + sc * Cx) / (sc + sd);
    let Dy = (sd * By + sc * Cy) / (sc + sd);
    let t = ((Dx - Gx) * (Ay - Gy) - (Ax - Gx) * (Dy - Gy)) / ((Dx - Gx) * (Cy - Gy) - (Cx - Gx) * (Dy - Gy));
    let Ex = Gx + t * (Cx - Gx);
    let Ey = Gy + t * (Cy - Gy);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${svgWidth}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${svgWidth}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ax}" y1="${Ay}" x2="${Dx}" y2="${Dy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
            <line x1="${Gx}" y1="${Gy}" x2="${Cx}" y2="${Cy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Gx}" cy="${Gy}" r="6" fill="#4CAF50"/>
            <circle cx="${Dx}" cy="${Dy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Gx-labelOffset}" y="${Gy}" text-anchor="middle">G</text>
            <text x="${Dx}" y="${Dy+labelOffset}" text-anchor="middle">D</text>
            <text x="${Ex+labelOffset}" y="${Ey-labelOffset}" text-anchor="middle">E</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，AG将AB分成两段，<br>
        \\( AG:GB = ${sa}:${sb} \\)，BD将BC分成两段，<br>
        \\( BD:DC = ${sc}:${sd} \\)，E为AD与GC交点，<br>
        求AE:EC。<div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel3Question() {
    let a = Math.floor(Math.random() * 3) + 1, b = Math.floor(Math.random() * 3) + 1, m = Math.floor(Math.random() * 3) + 1, n = Math.floor(Math.random() * 3) + 1;
    let areaBCO = (Math.floor(Math.random() * 4) + 1) * b * n;
    let areaABC = areaBCO * (a * (m + n) + b * n) / (b * n);
    areaABC = Math.round(areaABC);
    correctAnswer = [areaABC + ''];
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Gx = (b * Ax + a * Bx) / (a + b);
    let Gy = (b * Ay + a * By) / (a + b);
    let Ox = (n * Bx + m * Cx) / (m + n);
    let Oy = (n * By + m * Cy) / (m + n);
    let t = ((Ox - Gx) * (Ay - Gy) - (Ax - Gx) * (Oy - Gy)) / ((Ox - Gx) * (Cy - Gy) - (Cx - Gx) * (Oy - Gy));
    let Ex = Gx + t * (Cx - Gx);
    let Ey = Gy + t * (Cy - Gy);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${width}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${width}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ax}" y1="${Ay}" x2="${Ox}" y2="${Oy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
            <line x1="${Gx}" y1="${Gy}" x2="${Cx}" y2="${Cy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Gx}" cy="${Gy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ox}" cy="${Oy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Gx-labelOffset}" y="${Gy}" text-anchor="middle">G</text>
            <text x="${Ox}" y="${Oy+labelOffset}" text-anchor="middle">O</text>
            <text x="${Ex+labelOffset}" y="${Ey-labelOffset}" text-anchor="middle">E</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，AG将AB分成两段，<br>
        \\( AG:GB = ${a}:${b} \\)，BO将BC分成两段，<br>
        \\( BO:OC = ${m}:${n} \\)，E为AO与GC交点，<br>
        \\( S_{\\triangle BCO} = ${areaBCO} \\)，求 \\( S_{\\triangle ABC} \\)。<div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel4Question() {
    // 生成AG:GB = a:b (化简后的比例)
    let a = Math.floor(Math.random() * 3) + 1;
    let b = Math.floor(Math.random() * 3) + 1;
    // 生成BD:DC = m:n (化简后的比例)
    let m = Math.floor(Math.random() * 3) + 1;
    let n = Math.floor(Math.random() * 3) + 1;

    // 生成一个随机的三角形BCO面积
    let areaBCO = (Math.floor(Math.random() * 4) + 1) * b * n;  // b*n的倍数
    // 根据燕尾模型，计算三角形ABC的面积
    // S_ABC = S_BCO * (a*(m+n) + b*n) / (b*n)
    let areaABC = areaBCO * (a * (m + n) + b * n) / (b * n);
    areaABC = Math.round(areaABC);

    // 三角形ABC的顶点
    const pointA = {x: 100, y: 20};
    const pointB = {x: 20, y: 130};
    const pointC = {x: 180, y: 130};

    // 计算点G在AB上的位置 (AG:GB = a:b)
    const pointG = {
        x: (a * pointB.x + b * pointA.x) / (a + b),
        y: (a * pointB.y + b * pointA.y) / (a + b)
    };
    // 计算点D在BC上的位置 (BD:DC = m:n)
    const pointD = {
        x: (m * pointC.x + n * pointB.x) / (m + n),
        y: (m * pointC.y + n * pointB.y) / (m + n)
    };
    // 3. CE:EA = b*n:a*m
    let ratioCE = b * n;
    let ratioEA = a * m;
    let gcdCEEA = gcd(ratioCE, ratioEA);
    let simplifiedCE = ratioCE / gcdCEEA;
    let simplifiedEA = ratioEA / gcdCEEA;
    // 4. AO:OD = a*(m+n):b*n
    let ratioAO = a * (m + n);
    let ratioOD = b * n;
    let gcdAOOD = gcd(ratioAO, ratioOD);
    let simplifiedAO = ratioAO / gcdAOOD;
    let simplifiedOD = ratioOD / gcdAOOD;
    // 5. BO:OE = (a*m + b*n):a*n
    let ratioBO = a * m + b * n;
    let ratioOE = a * n;
    let gcdBOOE = gcd(ratioBO, ratioOE);
    let simplifiedBO = ratioBO / gcdBOOE;
    let simplifiedOE = ratioOE / gcdBOOE;
    // 6. CO:OG = (a+b)*n:a*m
    let ratioCO = (a + b) * n;
    let ratioOG = a * m;
    let gcdCOOG = gcd(ratioCO, ratioOG);
    let simplifiedCO = ratioCO / gcdCOOG;
    let simplifiedOG = ratioOG / gcdCOOG;
    // 计算点E (CE:EA = b*n:a*m)
    const pointE = {
        x: (ratioEA * pointC.x + ratioCE * pointA.x) / (ratioCE + ratioEA),
        y: (ratioEA * pointC.y + ratioCE * pointA.y) / (ratioCE + ratioEA)
    };
    // 计算AD和CG的交点O
    const adDx = pointD.x - pointA.x;
    const adDy = pointD.y - pointA.y;
    const cgDx = pointG.x - pointC.x;
    const cgDy = pointG.y - pointC.y;
    const denominator = adDx * cgDy - adDy * cgDx;
    const t = ((pointC.x - pointA.x) * cgDy - (pointC.y - pointA.y) * cgDx) / denominator;
    const pointO = {
        x: pointA.x + t * adDx,
        y: pointA.y + t * adDy
    };
    // 创建SVG图形
    const svg = `
    <svg width="200" height="150" xmlns="http://www.w3.org/2000/svg">
        <!-- 三角形ABC -->
        <polygon points="${pointA.x},${pointA.y} ${pointB.x},${pointB.y} ${pointC.x},${pointC.y}" fill="#f0f8ff" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线AD -->
        <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointD.x}" y2="${pointD.y}" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线CG -->
        <line x1="${pointC.x}" y1="${pointC.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#2196F3" stroke-width="2"/>
        <!-- 直线BE -->
        <line x1="${pointB.x}" y1="${pointB.y}" x2="${pointE.x}" y2="${pointE.y}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3"/>
        <!-- 直线OO -->
        <line x1="${pointO.x}" y1="${pointO.y}" x2="${pointD.x}" y2="${pointD.y}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3"/>
        <!-- 标记三角形BCO区域 (填充浅绿色) -->
        <polygon points="${pointB.x},${pointB.y} ${pointC.x},${pointC.y} ${pointO.x},${pointO.y}" fill="#e6ffe6" stroke="#2196F3" stroke-width="1.5" stroke-dasharray="3,3"/>
        <!-- 顶点标注 -->
        <circle cx="${pointA.x}" cy="${pointA.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointB.x}" cy="${pointB.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointC.x}" cy="${pointC.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointD.x}" cy="${pointD.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointE.x}" cy="${pointE.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointG.x}" cy="${pointG.y}" r="6" fill="#4CAF50"/>
        <circle cx="${pointO.x}" cy="${pointO.y}" r="6" fill="#4CAF50"/>
        <text x="${pointA.x}" y="${pointA.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">A</text>
        <text x="${pointB.x-10}" y="${pointB.y+15}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">B</text>
        <text x="${pointC.x+10}" y="${pointC.y+15}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">C</text>
        <text x="${pointD.x}" y="${pointD.y+18}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">D</text>
        <text x="${pointE.x+15}" y="${pointE.y+5}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">E</text>
        <text x="${pointG.x-10}" y="${pointG.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">G</text>
        <text x="${pointO.x+10}" y="${pointO.y-10}" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#666">O</text>
        <!-- 面积标注 -->
        <text x="${(pointB.x + pointC.x + pointO.x)/3}" y="${(pointB.y + pointC.y + pointO.y)/3}" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">S△BCO=${areaBCO}</text>
    </svg>
    `;
    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，三角形ABC中，\\
        BO:OE = ${simplifiedBO}:${simplifiedOE}，
        CO:OG = ${simplifiedCO}:${simplifiedOG}，\\
        S_{\\triangle BCO} = ${areaBCO}平方厘米，\\
        则S_{\\triangle ABC} = \\_平方厘米。
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateLevel5Question() {
    let a = Math.floor(Math.random() * 5) + 1, b = Math.floor(Math.random() * 5) + 1, m = Math.floor(Math.random() * 5) + 1, n = Math.floor(Math.random() * 5) + 1;
    let areaEBD = b * m * (Math.floor(Math.random() * 10) + 1);
    let areaABC = areaEBD * (a + b) * (m + n) / (b * m);
    areaABC = Math.round(areaABC);
    correctAnswer = [areaABC + ''];
    let svgWidth = 220, svgHeight = 180;
    let Ax = 110, Ay = 30;
    let Bx = 30, By = 150;
    let Cx = 190, Cy = 150;
    let Ex = (b * Ax + a * Bx) / (a + b);
    let Ey = (b * Ay + a * By) / (a + b);
    let Dx = (n * Ax + m * Cx) / (m + n);
    let Dy = (n * Ay + m * Cy) / (m + n);
    const labelOffset = 15;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g id="gridGroup">
            <line x1="0" y1="${(Ay+By)/2}" x2="${svgWidth}" y2="${(Ay+By)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
            <line x1="0" y1="${(Ay+Cy)/2}" x2="${svgWidth}" y2="${(Ay+Cy)/2}" stroke="#eee" stroke-width="0.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="axisGroup">
            <line x1="${Bx}" y1="${By}" x2="${Cx}" y2="${Cy}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="shapeGroup">
            <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="#e6f2ff" stroke="#2196F3" stroke-width="2" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${Ex}" y1="${Ey}" x2="${Dx}" y2="${Dy}" stroke="#ff4444" stroke-width="2" stroke-dasharray="3,3" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${Ax}" cy="${Ay}" r="6" fill="#4CAF50"/>
            <circle cx="${Bx}" cy="${By}" r="6" fill="#4CAF50"/>
            <circle cx="${Cx}" cy="${Cy}" r="6" fill="#4CAF50"/>
            <circle cx="${Ex}" cy="${Ey}" r="6" fill="#4CAF50"/>
            <circle cx="${Dx}" cy="${Dy}" r="6" fill="#4CAF50"/>
        </g>
        <g id="labelsGroup" font-size="14" font-family="Arial" fill="#666" font-weight="bold">
            <text x="${Ax}" y="${Ay-labelOffset}" text-anchor="middle">A</text>
            <text x="${Bx-labelOffset}" y="${By+labelOffset}" text-anchor="middle">B</text>
            <text x="${Cx+labelOffset}" y="${Cy+labelOffset}" text-anchor="middle">C</text>
            <text x="${Ex-labelOffset}" y="${Ey}" text-anchor="middle">E</text>
            <text x="${Dx+labelOffset}" y="${Dy}" text-anchor="middle">D</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        在△ABC中，<br>
        AE将AB分成两段，\\( AE:EB = ${a}:${b} \\)，<br>
        AD将AC分成两段，\\( AD:DC = ${m}:${n} \\)，<br>
        已知\\( S_1 = ${areaEBD} \\)，求\\( S_{\\triangle ABC} \\)。
        <div style="margin-top: 18px;">${svg}</div>
    </div>
    `;
    return question;
}

function generateLevel6Question() {
    // 生成AG:GB = a:b (化简后的比例)
    let a = Math.floor(Math.random() * 3) + 1;
    let b = Math.floor(Math.random() * 3) + 1;
    // 生成AF:FD = m:n (化简后的比例)
    let m = Math.floor(Math.random() * 3) + 1;
    let n = Math.floor(Math.random() * 3) + 1;

    // 生成一个随机的三角形BDO面积
    let areaBDO = (Math.floor(Math.random() * 4) + 1) * b * n;  // b*n的倍数
    // 根据模型，计算四边形ABCD的面积
    // S_ABCD = S_BDO * (a*(m+n) + b*n + b*m) / (b*n)
    let areaABCD = areaBDO * (a * (m + n) + b * n + b * m) / (b * n);
    areaABCD = Math.round(areaABCD);

    // 矩形ABCD的顶点，按图片顺序：A(左下)、B(右下)、C(右上)、D(左上)
    const pointA = {x: 40, y: 260};
    const pointB = {x: 360, y: 260};
    const pointC = {x: 360, y: 40};
    const pointD = {x: 40, y: 40};

    // G在AB上，AG:GB = a:b
    const pointG = {
        x: (b * pointA.x + a * pointB.x) / (a + b),
        y: (b * pointA.y + a * pointB.y) / (a + b)
    };
    // F在AD上，AF:FD = m:n
    const pointF = {
        x: (n * pointA.x + m * pointD.x) / (m + n),
        y: (n * pointA.y + m * pointD.y) / (m + n)
    };
    // E为DB与AF交点
    function getLineIntersection(p1, p2, p3, p4) {
        const a1 = p2.y - p1.y;
        const b1 = p1.x - p2.x;
        const c1 = a1 * p1.x + b1 * p1.y;
        const a2 = p4.y - p3.y;
        const b2 = p3.x - p4.x;
        const c2 = a2 * p3.x + b2 * p3.y;
        const det = a1 * b2 - a2 * b1;
        if (det === 0) return {x: NaN, y: NaN};
        return {
            x: (b2 * c1 - b1 * c2) / det,
            y: (a1 * c2 - a2 * c1) / det
        };
    }
    const pointE = getLineIntersection(pointD, pointB, pointA, pointF);
    // O为BF与DG的交点
    const pointO = getLineIntersection(pointB, pointF, pointD, pointG);

    // 偏移参数
    const labelOffset = 15;
    // 创建SVG图形
    const svg = `
    <svg width="400" height="300" xmlns="http://www.w3.org/2000/svg">
        <g id="shapeGroup">
            <polygon points="${pointA.x},${pointA.y} ${pointB.x},${pointB.y} ${pointC.x},${pointC.y} ${pointD.x},${pointD.y}" fill="#fff" stroke="#000" stroke-width="2" vector-effect="non-scaling-stroke"/>
            <polygon points="${pointD.x},${pointD.y} ${pointB.x},${pointB.y} ${pointO.x},${pointO.y}" fill="#e6ffe6" stroke="none"/>
        </g>
        <g id="auxLineGroup">
            <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointF.x}" y2="${pointF.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointA.x}" y1="${pointA.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointD.x}" y1="${pointD.y}" x2="${pointB.x}" y2="${pointB.y}" stroke="#000" stroke-width="1.5" stroke-dasharray="4,4" vector-effect="non-scaling-stroke"/>
            <line x1="${pointD.x}" y1="${pointD.y}" x2="${pointG.x}" y2="${pointG.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
            <line x1="${pointB.x}" y1="${pointB.y}" x2="${pointF.x}" y2="${pointF.y}" stroke="#000" stroke-width="1.5" vector-effect="non-scaling-stroke"/>
        </g>
        <g id="pointsGroup">
            <circle cx="${pointA.x}" cy="${pointA.y}" r="4" fill="#000"/>
            <circle cx="${pointB.x}" cy="${pointB.y}" r="4" fill="#000"/>
            <circle cx="${pointC.x}" cy="${pointC.y}" r="4" fill="#000"/>
            <circle cx="${pointD.x}" cy="${pointD.y}" r="4" fill="#000"/>
            <circle cx="${pointF.x}" cy="${pointF.y}" r="4" fill="#000"/>
            <circle cx="${pointG.x}" cy="${pointG.y}" r="4" fill="#000"/>
            <circle cx="${pointO.x}" cy="${pointO.y}" r="2" fill="#000"/>
        </g>
        <g id="labelsGroup" font-size="16" font-family="Arial" fill="#222" font-weight="bold">
            <text x="${pointA.x-10}" y="${pointA.y+15}" text-anchor="middle">A</text>
            <text x="${pointB.x+10}" y="${pointB.y+15}" text-anchor="middle">B</text>
            <text x="${pointC.x+10}" y="${pointC.y-5}" text-anchor="middle">C</text>
            <text x="${pointD.x-10}" y="${pointD.y-5}" text-anchor="middle">D</text>
            <text x="${pointF.x-10}" y="${pointF.y+5}" text-anchor="middle">F</text>
            <text x="${pointG.x}" y="${pointG.y+20}" text-anchor="middle">G</text>
            <text x="${pointO.x-10}" y="${pointO.y+10}" text-anchor="middle">O</text>
        </g>
        <g id="markersGroup" font-size="14" font-family="Arial" fill="#666">
            <text x="${(pointB.x + pointD.x + pointO.x)/3}" y="${(pointB.y + pointD.y + pointO.y)/3}" text-anchor="middle">S=${areaBDO}</text>
        </g>
    </svg>
    `;
    // 格式化问题文本
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，矩形ABCD中，\\
        AG:GB = ${a}:${b}，AF:FD = ${m}:${n}，\\
        S_{\\triangle BDO} = ${areaBDO}平方厘米，\\
        则S_{ABCD} = \\_平方厘米。
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
        <div style="text-align:center;margin-top:5px;">\\( S_{\\triangle BDO} = ${areaBDO} \\)</div>
    </div>
    `;
    correctAnswer = [`${areaABCD}`];
    return question;
}

function generateLevel7Question() {
    // 直接复用前6种题型的SVG生成函数，已全部优化
    const levels = [generateLevel1Question, generateLevel2Question, generateLevel3Question, generateLevel4Question, generateLevel5Question, generateLevel6Question];
    return levels[Math.floor(Math.random() * levels.length)]();
}

// ===== F05中考模型题型生成函数（完整版） =====
function generateF05Level1Question() {
    const pythagoreanTriplets = [
        [6, 8, 10], [12, 16, 20], [5, 12, 13], [9, 12, 15], [15, 20, 25], [10, 24, 26], [8, 15, 17]
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let AB = a;
    let ratio = Math.random() * 0.6 + 0.2;
    let AM = Math.round(b * ratio);
    let BN = b - AM;
    let minValue = Math.sqrt(AB*AB + (AM+BN)*(AM+BN));
    const width = 420, height = Math.max(AM,BN)*40;
    const Ax = 210-AM*10, Ay = height/2;
    const Bx = 210+BN*10, By = height/2;
    const Mx = Ax, My = Ay - AM*15;
    const Nx = Bx, Ny = By - BN*15;
    const Px = (BN*Ax + AM*Bx) / (b), Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+12}" font-family="serif" font-size="22">A</text>
        <text x="${Bx+16}" y="${By+12}" font-family="serif" font-size="22">B</text>
        <text x="${Mx-16}" y="${My-12}" font-family="serif" font-size="22">M</text>
        <text x="${Nx+16}" y="${Ny-12}" font-family="serif" font-size="22">N</text>
        <text x="${(Ax+Bx)/2}" y="${Ay+36}" text-anchor="middle" font-family="serif" font-size="20">AB = ${AB}</text>
        <text x="${Ax-36}" y="${(Ay+My)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-90,${Ax-36},${(Ay+My)/2})">${AM}</text>
        <text x="${Bx+36}" y="${(By+Ny)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-90,${Bx+36},${(By+Ny)/2})">${BN}</text>
    </svg>`;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\
        其中AM = ${AM}，BN = ${BN}，AB = ${AB}，\\
        求|PM|+|PN|的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${minValue}`, `${c}`];
    return question;
}

function generateF05Level2Question() {
    const pythagoreanTriplets = [
        [6, 8, 10], [12, 16, 20], [5, 12, 13], [9, 12, 15], [15, 20, 25], [10, 24, 26], [8, 15, 17]
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let AB = b;
    let BN = Math.floor(Math.random() * 10) + 5;
    let AM = BN + a;
    let maxDifference = c;
    // 计算图形中的位置
    const width = 420;
    const height = Math.max(AM,BN)*40;
    const Ax = 30;
    const Ay = height/2;
    const Bx = 30+AB*10;
    const By = height/2;
    const Mx = Ax;
    const My = Ay - AM*10;
    const Nx = Bx;
    const Ny = By - BN*10;
    const Px = (Ax + Bx) / 2;
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Mx}" y1="${My}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+12}" font-family="serif" font-size="22">A</text>
        <text x="${Bx+16}" y="${By+12}" font-family="serif" font-size="22">B</text>
        <text x="${Mx-16}" y="${My-12}" font-family="serif" font-size="22">M</text>
        <text x="${Nx+16}" y="${Ny-12}" font-family="serif" font-size="22">N</text>
        <text x="${(Ax+Bx)/2}" y="${Ay+36}" text-anchor="middle" font-family="serif" font-size="20">AB = ${AB}</text>
        <text x="${Ax-10}" y="${(Ay+My)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-0,${Ax-10},${(Ay+My)/2})">${AM}</text>
        <text x="${Bx+10}" y="${(By+Ny)/2}" text-anchor="middle" font-family="serif" font-size="20" transform="rotate(-0,${Bx+10},${(By+Ny)/2})">${BN}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\\\
        其中AM = ${AM}，BN = ${BN}，AB = ${AB}，\\\\
        已知AM - BN = ${a}，\\\\
        求||PM|-|PN||的最大值。\\\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${c}`,];
    return question;
}

function generateF05Level3Question() {
    // 一线三直角
    const pythagoreanTriplets = [
        [4, 6, 3, 8], [4, 6, 2, 12], [4, 6, 8, 3], [4, 6, 12, 2], [4, 3, 12, 1], [4, 3, 2, 6], [6, 3, 2, 9], [6, 3, 9, 2],
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], m = selectedTriplet[2], n = selectedTriplet[3];
    let AB = m + n;
    let AM = a;
    let BN = b;
    const width = 420;
    const height = 400;
    const Ax = 30;
    const Ay = height/2;
    const Bx = 30+AB*20;
    const By = height/2;
    const Mx = Ax;
    const My = Ay - a*20;
    const Nx = Bx;
    const Ny = By - b*20;
    const Px = (m*Ax + n*Bx) / (n+m);
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="1"/>
        <line x1="${Ax}" y1="${Ay}" x2="${Mx}" y2="${My}" stroke="blue" stroke-width="1"/>
        <line x1="${Bx}" y1="${By}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="1"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <circle cx="${Mx}" cy="${My}" r="5" fill="black"/>
        <circle cx="${Nx}" cy="${Ny}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Mx}" y2="${My}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Nx}" y2="${Ny}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Mx}" y1="${My}" x2="${Nx}" y2="${Ny}" stroke="blue" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+24}" font-family="serif" font-size="22">A(0,0)</text>
        <text x="${Bx+16}" y="${By+24}" font-family="serif" font-size="22">B(${m+n},${b})</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，P是线段AB上的一个动点，\\
        AM垂直于AB，BN垂直于AB，\\
        其中AM = ${a}，BN = ${b}，AB = ${m+n}，\\
        求AP、BP的值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${m},${n}`, `${n},${m}`];
    return question;
}

function generateF05Level4Question() {
    // 胡不归
    const pythagoreanTriplets = [
        [3, 4, 5], [4, 3, 5], [5, 12, 13],
    ];
    const randomIndex = Math.floor(Math.random() * pythagoreanTriplets.length);
    const selectedTriplet = pythagoreanTriplets[randomIndex];
    let a = selectedTriplet[0], b = selectedTriplet[1], c = selectedTriplet[2];
    let m = Math.floor(Math.random() * 2) + 1;
    let n = Math.floor(Math.random() * 2) + 1;
    const width = 420*(c*m+a*n)/14;
    const height = 400*b*n/14;
    const Ax = 30;
    const Ay = height/1.6;
    const Bx = 30+(c*m+a*n)*10;
    const By = height/1.6-(b*n)*10;
    const Px = 30+(c*m)*10;
    const Py = Ay;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <line x1="0" y1="${Ay}" x2="${width}" y2="${Ay}" stroke="black" stroke-width="2"/>
        <circle cx="${Px}" cy="${Py}" r="5" fill="red"/>
        <circle cx="${Ax}" cy="${Ay}" r="5" fill="black"/>
        <circle cx="${Bx}" cy="${By}" r="5" fill="black"/>
        <line x1="${Px}" y1="${Py}" x2="${Ax}" y2="${Ay}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <line x1="${Px}" y1="${Py}" x2="${Bx}" y2="${By}" stroke="red" stroke-width="2.5" stroke-dasharray="6,6"/>
        <text x="${Px}" y="${Py+22}" font-family="serif" font-size="22">P</text>
        <text x="${Ax-16}" y="${Ay+24}" font-family="serif" font-size="22">A(0,0)</text>
        <text x="${Bx+16}" y="${By+24}" font-family="serif" font-size="22">B(${c*m+a*n},${b*n})</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，点A坐标(0,0)，点B坐标(${c*m+a*n},${b*n})，\\ P是直线AC上的一个动点，\\
        求BP+\\frac{${a}}{${c}}PA的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${m*b+n*a}`];
    return question;
}

function generateF05Level5Question() {
    // 鸟头模型1
    let a = Math.floor(Math.random() * 5) + 1;
    let b = Math.floor(Math.random() * 5) + 1;
    let m = Math.floor(Math.random() * 5) + 1;
    let n = Math.floor(Math.random() * 5) + 1;
    let divisor_ab = gcd(a, b);
    let divisor_mn = gcd(m, n);
    let simplified_a = a / divisor_ab;
    let simplified_b = b / divisor_ab;
    let simplified_m = m / divisor_mn;
    let simplified_n = n / divisor_mn;
    let areaFactor = Math.floor(Math.random() * 10) + 1;
    let areaAED = a * m * areaFactor;
    let areaABC = areaAED * (a + b) * (m + n) / (a * m);
    areaABC = Math.round(areaABC);
    const width = 200;
    const height = 150;
    const Ax = 100;
    const Ay = 20;
    const Bx = 20;
    const By = 130;
    const Cx = 180;
    const Cy = 130;
    const eRatio = a / (a + b);
    const Ex = Ax - (Ax - Bx) * eRatio;
    const Ey = Ay + (By - Ay) * eRatio;
    const dRatio = m / (m + n);
    const Dx = Ax - (Ax - Cx) * dRatio;
    const Dy = Ay + (Cy - Ay) * dRatio;
    const centroidAEDx = (Ax + Ex + Dx) / 3;
    const centroidAEDy = (Ay + Ey + Dy) / 3;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="none" stroke="black" stroke-width="1.5"/>
        <polygon points="${Ax},${Ay} ${Ex},${Ey} ${Dx},${Dy}" fill="#e6f2ff" stroke="black" stroke-width="1.5"/>
        <circle cx="${Ex}" cy="${Ey}" r="3" fill="black"/>
        <circle cx="${Dx}" cy="${Dy}" r="3" fill="black"/>
        <text x="${Ax}" y="${Ay-5}" text-anchor="middle" font-family="serif" font-size="16">A</text>
        <text x="${Bx-5}" y="${By+5}" text-anchor="middle" font-family="serif" font-size="16">B</text>
        <text x="${Cx+5}" y="${Cy+5}" text-anchor="middle" font-family="serif" font-size="16">C</text>
        <text x="${Ex-5}" y="${Ey-5}" text-anchor="middle" font-family="serif" font-size="16">E</text>
        <text x="${Dx+5}" y="${Dy-5}" text-anchor="middle" font-family="serif" font-size="16">D</text>
        <text x="${centroidAEDx}" y="${centroidAEDy}" text-anchor="middle" font-family="serif" font-size="14">S₁=${areaAED}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        在\\triangle ABC中，E是AB边上的点，D是AC边上的点，\\
        且AE:EB = ${simplified_a}:${simplified_b}，AD:DC = ${simplified_m}:${simplified_n}，\\
        已知\\triangle AED的面积S_1=${areaAED}，\\
        求\\triangle ABC的面积S\\triangle ABC。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateF05Level6Question() {
    // 鸟头模型2
    let a = Math.floor(Math.random() * 5) + 1;
    let b = Math.floor(Math.random() * 5) + 1;
    let m = Math.floor(Math.random() * 5) + 1;
    let n = Math.floor(Math.random() * 5) + 1;
    let divisor_ab = gcd(a, b);
    let divisor_mn = gcd(m, n);
    let simplified_a = a / divisor_ab;
    let simplified_b = b / divisor_ab;
    let simplified_m = m / divisor_mn;
    let simplified_n = n / divisor_mn;
    let areaFactor = Math.floor(Math.random() * 10) + 1;
    let areaEBD = b * m * areaFactor;
    let areaABC = areaEBD * (a + b) * (m + n) / (b * m);
    areaABC = Math.round(areaABC);
    const width = 200;
    const height = 150;
    const Ax = 100;
    const Ay = 20;
    const Bx = 20;
    const By = 130;
    const Cx = 180;
    const Cy = 130;
    const eRatio = a / (a + b);
    const Ex = Ax - (Ax - Bx) * eRatio;
    const Ey = Ay + (By - Ay) * eRatio;
    const dRatio = m / (m + n);
    const Dx = Ax - (Ax - Cx) * dRatio;
    const Dy = Ay + (Cy - Ay) * dRatio;
    const centroidEBDx = (Ex + Bx + Dx) / 3;
    const centroidEBDy = (Ey + By + Dy) / 3;
    const svg = `
    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
        <polygon points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy}" fill="none" stroke="black" stroke-width="1.5"/>
        <polygon points="${Ex},${Ey} ${Bx},${By} ${Dx},${Dy}" fill="#e6f2ff" stroke="black" stroke-width="1.5"/>
        <circle cx="${Ex}" cy="${Ey}" r="3" fill="black"/>
        <circle cx="${Dx}" cy="${Dy}" r="3" fill="black"/>
        <text x="${Ax}" y="${Ay-5}" text-anchor="middle" font-family="serif" font-size="16">A</text>
        <text x="${Bx-5}" y="${By+5}" text-anchor="middle" font-family="serif" font-size="16">B</text>
        <text x="${Cx+5}" y="${Cy+5}" text-anchor="middle" font-family="serif" font-size="16">C</text>
        <text x="${Ex-5}" y="${Ey-5}" text-anchor="middle" font-family="serif" font-size="16">E</text>
        <text x="${Dx+5}" y="${Dy-5}" text-anchor="middle" font-family="serif" font-size="16">D</text>
        <text x="${centroidEBDx}" y="${centroidEBDy}" text-anchor="middle" font-family="serif" font-size="14">S₁=${areaEBD}</text>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        在\\triangle ABC中，E是AB边上的点，D是AC边上的点，\\
        且AE:EB = ${simplified_a}:${simplified_b}，AD:DC = ${simplified_m}:${simplified_n}，\\
        已知\\triangle EBD的面积S_1=${areaEBD}，\\
        求\\triangle ABC的面积S\\triangle ABC。\\
        \\end{array}
        <div style="margin-top: 15px;">${svg}</div>
    </div>
    `;
    correctAnswer = [`${areaABC}`];
    return question;
}

function generateF05Level7Question() {
    // 阿氏圆
    const configurations = [
        { r: 2, C: [1, 0], B: [4, 0], ratio: 1/2, ratioText: "\\frac{1}{2}" },
        { r: 3, C: [1, 0], B: [9, 0], ratio: 1/3, ratioText: "\\frac{1}{3}" }
    ];
    const config = configurations[Math.floor(Math.random() * configurations.length)];
    const pythagoreanTriplets = [
        {a: 3, b: 4, c: 5},
        {a: 5, b: 12, c: 13},
        {a: 6, b: 8, c: 10},
        {a: 8, b: 15, c: 17}
    ];
    const triplet = pythagoreanTriplets[Math.floor(Math.random() * pythagoreanTriplets.length)];
    const r = config.r;
    const C = config.C;
    const B = config.B;
    const A = [C[0] + triplet.a, triplet.b];
    const Px = Math.sqrt(r*r/2);
    const Py = Math.sqrt(r*r/2);
    const scale = 25;
    const svgWidth = 500;
    const svgHeight = 450;
    const offsetX = Math.round(svgWidth * 0.5);
    const offsetY = 250;
    const svg = `
    <svg width="${svgWidth}" height="${svgHeight}" xmlns="http://www.w3.org/2000/svg">
        <g transform="translate(-${svgWidth/4}, ${svgHeight/4})">
            <line x1="0" y1="${offsetY}" x2="${svgWidth}" y2="${offsetY}" stroke="black" stroke-width="1"/>
            <line x1="${offsetX}" y1="0" x2="${offsetX}" y2="${svgHeight}" stroke="black" stroke-width="1"/>
            <text x="${offsetX-20}" y="${offsetY+20}" font-family="serif" font-size="16">O</text>
            <circle cx="${offsetX}" cy="${offsetY}" r="${r * scale}" fill="none" stroke="blue" stroke-width="1.5"/>
            <circle cx="${offsetX + C[0] * scale}" cy="${offsetY - C[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + C[0] * scale - 20}" y="${offsetY - C[1] * scale + 20}" font-family="serif" font-size="16">C(${C[0]},${C[1]})</text>
            <circle cx="${offsetX + B[0] * scale}" cy="${offsetY - B[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + B[0] * scale - 10}" y="${offsetY - B[1] * scale + 20}" font-family="serif" font-size="16">B(${B[0]},${B[1]})</text>
            <circle cx="${offsetX + A[0] * scale}" cy="${offsetY - A[1] * scale}" r="4" fill="black"/>
            <text x="${offsetX + A[0] * scale - 10}" y="${offsetY - A[1] * scale - 10}" font-family="serif" font-size="16">A(${A[0]},${A[1]})</text>
            <circle cx="${offsetX + Px * scale}" cy="${offsetY - Py * scale}" r="4" fill="red"/>
            <text x="${offsetX + Px * scale - 10}" y="${offsetY - Py * scale - 10}" font-family="serif" font-size="16">P</text>
            <line x1="${offsetX + C[0] * scale}" y1="${offsetY - C[1] * scale}"
                  x2="${offsetX + A[0] * scale}" y2="${offsetY - A[1] * scale}"
                  stroke="gray" stroke-width="1" stroke-dasharray="4,4"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + A[0] * scale}" y2="${offsetY - A[1] * scale}"
                  stroke="red" stroke-width="1.5"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + B[0] * scale}" y2="${offsetY - B[1] * scale}"
                  stroke="blue" stroke-width="1.5"/>
            <line x1="${offsetX}" y1="${offsetY}"
                  x2="${offsetX + Px * scale}" y2="${offsetY - Py * scale}"
                  stroke="purple" stroke-width="1.5"/>
            <line x1="${offsetX + Px * scale}" y1="${offsetY - Py * scale}"
                  x2="${offsetX + C[0] * scale}" y2="${offsetY - C[1] * scale}"
                  stroke="purple" stroke-width="1.5"/>
            <text x="${offsetX - 100}" y="50" font-family="serif" font-size="16">圆C: x² + y² = ${r*r}</text>
        </g>
    </svg>
    `;
    const question = `
    <div style="text-align: center;">
        \\begin{array}{cc} 
        如图，点P在圆C:x^2+y^2=${r*r}上，\\
        C(${C[0]},${C[1]})，B(${B[0]},${B[1]})，A(${A[0]},${A[1]})，\\
        求AP+${config.ratioText}PB的最小值。\\
        \\end{array}
        <div style="margin-top: 15px;" id="svgContainer">${svg}</div>
    </div>
    `;
    const minValue = triplet.c;
    correctAnswer = [`${minValue}`];
    return question;
}

function generateF05Level8Question() {
    // 综合测试
    const levelFunctions = [
        generateF05Level1Question,
        generateF05Level2Question,
        generateF05Level3Question,
        generateF05Level4Question,
        generateF05Level5Question,
        generateF05Level6Question,
        generateF05Level7Question
    ];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];
    return selectedFunction();
}

// ========== 二级分组结构 ===========
const typeGroups = [
  {
    group: '燕尾模型类',
    types: [
      { name: '01燕尾模型', generator: generateLevel1Question },
      { name: '02燕尾模型两外比', generator: generateLevel2Question },
      { name: '03燕尾模型一内一外比', generator: generateLevel3Question },
      { name: '04燕尾模型两内比', generator: generateLevel4Question },
      { name: '05鸟头模型', generator: generateLevel5Question },
      { name: '06燕尾模型矩形面积', generator: generateLevel6Question },
      { name: '07综合测试', generator: generateLevel7Question },
    ]
  },
  {
    group: '中考模型类',
    types: [
      { name: '01将军饮马和最小值', generator: generateF05Level1Question },
      { name: '02将军饮马差最大值', generator: generateF05Level2Question },
      { name: '03一线三直角', generator: generateF05Level3Question },
      { name: '04胡不归', generator: generateF05Level4Question },
      { name: '05鸟头模型1', generator: generateF05Level5Question },
      { name: '06鸟头模型2', generator: generateF05Level6Question },
      { name: '07阿氏圆', generator: generateF05Level7Question },
      { name: '08综合测试', generator: generateF05Level8Question },
    ]
  },
  {
    group: '乘法公式类',
    types: [
      { name: '01分配律1', generator: generateB01Level1Question },
      { name: '02分配律2', generator: generateB01Level2Question },
      { name: '03两大公式', generator: generateB01Level3Question },
      { name: '04多项式乘多项式1', generator: generateB01Level4Question },
      { name: '05多项式乘多项式2', generator: generateB01Level5Question },
      { name: '06三个多项式相乘', generator: generateB01Level6Question },
      { name: '07两项乘三项', generator: generateB01Level7Question },
      { name: '08多项式除法求余', generator: generateB01Level8Question },
      { name: '09综合', generator: generateB01Level9Question },
    ]
  },
  {
    group: '乘法公式综合类',
    types: [
      { name: '01配方法顶点式', generator: generateB02Level1Question },
      { name: '02完全平方公式知二得四1', generator: generateB02Level2Question },
      { name: '03完全平方公式知二得四2', generator: generateB02Level3Question },
      { name: '04完全平方公式知二得四3', generator: generateB02Level4Question },
      { name: '05完全平方公式知二得四4', generator: generateB02Level5Question },
      { name: '06综合', generator: generateB02Level6Question },
    ]
  },
  {
    group: '因式分解基础类',
    types: [
      { name: '01首项系数为1', generator: generateB03Level1Question },
      { name: '02首项系数不为1', generator: generateB03Level2Question },
      { name: '03两大公式', generator: generateB03Level3Question },
      { name: '04首项系数为1十字交叉', generator: generateB03Level4Question },
      { name: '05首项系数不为1十字交叉', generator: generateB03Level5Question },
      { name: '06三次项', generator: generateB03Level6Question },
      { name: '07解二次方程', generator: generateB03Level7Question },
      { name: '08系数1双十字相乘', generator: generateB03Level8Question },
      { name: '09双十字相乘', generator: generateB03Level9Question },
      { name: '10综合', generator: generateB03Level10Question },
    ]
  },
  {
    group: '因式分解技巧类',
    types: [
      { name: '01提公因式', generator: generateB04Level1Question },
      { name: '02公式法', generator: generateB04Level2Question },
      { name: '03分组分解', generator: generateB04Level3Question },
      { name: '04拆项与添项', generator: generateB04Level4Question },
      { name: '05十字相乘', generator: generateB04Level5Question },
      { name: '06二元二次分解', generator: generateB04Level6Question },
      { name: '07综合运用', generator: generateB04Level7Question },
      { name: '08多项式的一次因式', generator: generateB04Level8Question },
      { name: '09综合随机测', generator: generateB04Level9Question },
    ]
  }
];

// ========== 分组选择栏渲染 ===========
function renderTypeSelect() {
  const container = document.getElementById('typeSelect');
  container.innerHTML = '';
  typeGroups.forEach((group, gIdx) => {
    const groupDiv = document.createElement('div');
    groupDiv.style.marginBottom = '18px';
    // 分组标题
    const groupTitle = document.createElement('div');
    groupTitle.style.fontWeight = 'bold';
    groupTitle.style.fontSize = '16px';
    groupTitle.style.color = '#2196F3';
    groupTitle.style.marginBottom = '6px';
    groupTitle.style.cursor = 'pointer';
    groupTitle.textContent = group.group;
    groupDiv.appendChild(groupTitle);
    // 题型项容器
    const itemsContainer = document.createElement('div');
    itemsContainer.style.display = 'none'; // 默认隐藏
    group.types.forEach((type, tIdx) => {
      const idx = `${gIdx}_${tIdx}`;
      const item = document.createElement('div');
      item.className = 'type-item';
      item.style.display = 'none'; // 默认隐藏
      item.innerHTML = `
        <input type="checkbox" id="type${idx}">
        <label for="type${idx}">${type.name}</label>
        <span>数量</span>
        <input type="number" id="num${idx}" min="1" max="50" value="3">
      `;
      itemsContainer.appendChild(item);
    });
    groupDiv.appendChild(itemsContainer);
    // 分组标题点击展开/收起
    groupTitle.addEventListener('click', function() {
      if (itemsContainer.style.display === 'none') {
        itemsContainer.style.display = '';
        Array.from(itemsContainer.children).forEach(e => e.style.display = '');
      } else {
        itemsContainer.style.display = 'none';
        Array.from(itemsContainer.children).forEach(e => e.style.display = 'none');
      }
    });
    container.appendChild(groupDiv);
  });
}

// ========== 生成所有题目 ===========
function generateAllQuestions() {
  const preview = document.getElementById('previewArea');
  let allQAs = [];
  typeGroups.forEach((group, gIdx) => {
    group.types.forEach((type, tIdx) => {
      const idx = `${gIdx}_${tIdx}`;
      const checked = document.getElementById(`type${idx}`).checked;
      const num = parseInt(document.getElementById(`num${idx}`).value);
      if (checked && num > 0) {
        for (let i = 0; i < num; i++) {
          let correctAnswer = [];
          window.correctAnswer = correctAnswer;
          const qHtml = type.generator();
          const aText = (window.correctAnswer || []).join(' 或 ');
          allQAs.push({
            group: group.group,
            type: type.name,
            qHtml,
            aText
          });
        }
      }
    });
  });
  if (allQAs.length === 0) {
    preview.innerHTML = '<div style="text-align:center;color:#888;">请至少选择一个题型并设置题目数量</div>';
    return;
  }
  let html = '<table class="qa-table"><thead><tr><th>分组</th><th>题型</th><th>题目</th><th>答案</th></tr></thead><tbody>';
  allQAs.forEach((qa, idx) => {
    html += `<tr><td>${qa.group}</td><td>${qa.type}</td><td>${qa.qHtml}</td><td>\\(${qa.aText}\\)</td></tr>`;
  });
  html += '</tbody></table>';
  preview.innerHTML = html;
  MathJax.typesetPromise([preview]);
}

// 初始化
renderTypeSelect();

// ========== B01乘法公式题型生成函数 ===========
function generateB01Level1Question() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let textm = m === 1 ? "+1" : (m === -1 ? "-1" : (m > 1 ? `+${m}` : `${m}`));
    let textm2 = m === 1 ? "+" : (m === -1 ? "-" : (m > 1 ? `+${m}` : `${m}`));
    correctAnswer = [`x^2${textm2}x`];           
    return `\\(\\begin{gather}展开: x(x${textm})\\\\ \\begin{array}{|c|c|c|} \\hline x &   &   \\\\ \\hline & x & ${m} \\\\ \\hline \\end{array} \\end{gather}\\)`;
}

function generateB01Level2Question() {
    let m = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let mn = m*n;    
    let textm = m === 1 ? "+1" : (m === -1 ? "-1" : (m > 1 ? `+${m}` : `${m}`));
    let textn  = n === 1 ? "" : (n === -1 ? "-" : (n > 1 ? `${n}` : `${n}`));
    let textmn = mn=== 1 ? "+" : (mn === -1 ? "-" : (mn > 1 ? `+${mn}` : `${mn}`));
    correctAnswer = [`${textn}x^2${textmn}x`];

   return `\\(\\begin{gather}展开:${textn}x(x${textm}) \\\\ \\begin{array}{|c|c|c|} \\hline bx & x^2 & abx \\\\ \\hline & x & a \\\\ \\hline \\end{array} \\end{gather}\\)`;
}

function generateB01Level3aQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let textm = m > 0 ? `+${m}` : `${m}`;

    let p = m + m;
    let t = m * m;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`x^2${textp}${textt}`];

    return `\\(\\begin{gather}展开:(x${textm})^2\\\\ \\begin{array}{|c|c|c|} \\hline a&ax& a^2\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level3bQuestion() {
    let m = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = -m ;

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let p = 0;
    let t = m * m;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`x^2-${t}`];

    return `\\(\\begin{gather}展开:(x${textm})(x${textn})\\\\ \\begin{array}{|c|c|c|} \\hline -a&-ax& -a^2\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level3cQuestion() {
    let m = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = -m ;

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let p = 0;
    let t = m * m;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`x^2-${t}`];

    return `\\(\\begin{gather}展开:(${m}+x)(x${textn})\\\\ \\begin{array}{|c|c|c|} \\hline -a&-ax& -a^2\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level3Question() {
    const levelFunctions = [
        generateB01Level3aQuestion,
        generateB01Level3bQuestion,
        generateB01Level3cQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB01Level4aQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let p = m + n;
    let t = m * n;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [ `x^2${textp}${textt}`];

    return `\\(\\begin{gather}展开:(x${textm})(x${textn}) \\\\ \\begin{array}{|c|c|c|} \\hline b&bx& ${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level4bQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let p = m + n;
    let t = m * n;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`x^2${textp}${textt}`];

    return `\\(\\begin{gather}展开:(x${textm})(x${textn}) \\\\ \\begin{array}{|c|c|c|} \\hline b&bx& ${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level4Question() {
    const levelFunctions = [
        generateB01Level4aQuestion,
        generateB01Level4bQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB01Level5aQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let p = m + n;
    let t = m * n;

    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [ `x^2${textp}${textt}`];

    return `\\(\\begin{gather}展开:(x${textm})(x${textn}) \\\\ \\begin{array}{|c|c|c|} \\hline b&bx& ${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level5bQuestion() {
    let c = (Math.floor(Math.random() * 5) + 2) * (Math.random() < 0.5 ? 1 : -1);
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;

    let pc = (m + n) * c;
    let tc = (m * n) * c;

    let textpc = pc === 0 ? "" : (pc > 0 ? `+${pc}x` : `${pc}x`);
    let texttc = tc === 0 ? "" : (tc > 0 ? `+${tc}` : `${tc}`);
    correctAnswer = [`${c}x^2${textpc}${texttc}`];
    if (m === n) {
        correctAnswer.push(`${c}(x${textm})^2`);
    }
    return `\\(\\begin{gather}展开:${c}(x${textm})(x${textn}) \\\\${c}\\times  \\begin{array}{|c|c|c|} \\hline b&bx& ${m*n}\\\\ \\hline x &x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB01Level5cQuestion() {
    let a = (Math.floor(Math.random() * 5) + 2) * (Math.random() < 0.5 ? 1 : -1);
    let b = (Math.floor(Math.random() * 5) + 2) * (Math.random() < 0.5 ? 1 : -1);
    let c = (Math.floor(Math.random() * 5) + 2) * (Math.random() < 0.5 ? 1 : -1);
    let d = (Math.floor(Math.random() * 5) + 2) * (Math.random() < 0.5 ? 1 : -1);

    let textb = b > 0 ? `+${b}y` : `${b}y`;
    let textd = d > 0 ? `+${d}y` : `${d}y`;

    let ac = a * c;
    let acpbd = (a * d) + (b * c);  // 这里应该是 a*d 和 b*c 的乘积和
    let bd = b * d;

    let textac = ac > 0 ? `+${ac}` : `${ac}`;
    let textacpbd = acpbd === 0 
        ? `` 
        : (acpbd === 1 
            ? `+xy` 
            : (acpbd === -1 
                ? `-xy` 
                : (acpbd > 0 
                    ? `+${acpbd}xy` 
                    : `${acpbd}xy`
                )
            )
        );

    let textbd = bd>0 ?  `+${bd}y^2` : `${bd}y^2`;
    
    let qtext = `(${a}x${textb})(${c}x${textd})`;

    correctAnswer = [`${ac}x^2${textacpbd}${textbd}`];
    
    return `\\(展开: ${qtext}\\)`;
}

function generateB01Level5Question() {
    const levelFunctions = [
        generateB01Level5aQuestion,
        generateB01Level5bQuestion,
        generateB01Level5cQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB01Level6aQuestion() {
    let a = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let b = (Math.floor(Math.random() * 3) + 4) ;
    let c = (Math.floor(Math.random() * 3) - 4) ;
    let ta   = a === 0 ? "" : (a > 0 ? `+${a}` : `${a}`);
    let tb   = b === 0 ? "" : (b > 0 ? `+${b}` : `${b}`);
    let tc   = c === 0 ? "" : (c > 0 ? `+${c}` : `${c}`);

    let x1=a+b+c;
    let x2=a*b+b*c+c*a;
    let x3=a*b*c;

    let textx1   = x1 === 0 ? "" : (x1 === 1 ? "+x^2" : (x1 === -1 ? "-x^2" :(x1 > 0 ? `+${x1}x^2` : `${x1}x^2`)));
    let textx2   = x2 === 0 ? "" : (x2 === 1 ? "+x" : (x2 === -1 ? "-x" :(x2 > 0 ? `+${x2}x` : `${x2}x`)));
    let textx3   = x3 === 0 ? "" : (x3 > 0 ? `+${x3}` : `${x3}`);

    correctAnswer = [ `x^3${textx1}${textx2}${textx3}` ];
   
    return `\\(\\begin{gather}展开:(x${ta})(x${tb})(x${tc}) \\\\ \\begin{array}{|c|c|c|c|} \\hline x^3&x^2&x&1\\\\ \\hline  \\hline1& a+b+c &ab+bc+ac &abc\\\\ \\hline \\end{array}\\\\

\\\\
\\begin{cases}
a+b+c=?x^2\\\\
ab+bc+ac=?x\\\\
abc=?\\\\

\\end{cases}\\\\

 \\end{gather}\\)`;
}

function generateB01Level6bQuestion() {
    let a = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let ta   = a === 0 ? "" : (a > 0 ? `+${a}` : `${a}`);

    let x1=3*a;
    let x2=3*a*a;
    let x3=a*a*a;

    let textx1   = x1 === 0 ? "" : (x1 === 1 ? "+x^2" : (x1 === -1 ? "-x^2" :(x1 > 0 ? `+${x1}x^2` : `${x1}x^2`)));
    let textx2   = x2 === 0 ? "" : (x2 === 1 ? "+x" : (x2 === -1 ? "-x" :(x2 > 0 ? `+${x2}x` : `${x2}x`)));
    let textx3   = x3 === 0 ? "" : (x3 > 0 ? `+${x3}` : `${x3}`);

    correctAnswer = [ `x^3${textx1}${textx2}${textx3}` ];
   
    return `\\(\\begin{gather}展开:(x${ta})^3 \\\\ \\begin{array}{|c|c|c|c|} \\hline x^3&x^2&x&1\\\\ \\hline  \\hline1& a+b+c  &ab+bc+ac&abc\\\\ \\hline \\end{array}\\\\

\\\\
\\begin{cases}
a+b+c=?x^2\\\\
ab+bc+ca=?x\\\\
abc=?\\\\

\\end{cases}\\\\

 \\end{gather}\\)`;
}

function generateB01Level6Question() {
    const levelFunctions = [
        generateB01Level6aQuestion,
        generateB01Level6bQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB01Level7Question() {
    let m = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);

    let a = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let b = (Math.floor(Math.random() * 3) + 4);
    let c = (Math.floor(Math.random() * 3) - 4);

    let tm = m === 1 ? "" : (m === -1 ? `-` : `${m}`);
    let tn = n > 0 ? `+${n}` : `${n}`;

    let ta = a === 1 ? "" : (a === -1 ? `-` : `${a}`);
    let tb = b > 0 ? `+${b}` : `${b}`;
    let tc = c > 0 ? `+${c}` : `${c}`; 

    let x1 = a * m;
    let x2 = a * n + b * m;
    let x3 = c * m + b * n;
    let x4 = c * n;

    let textx1 = x1 === 0 ? "" : (x1 === 1 ? "x^3" : (x1 === -1 ? "-x^3" :`${x1}x^3`));
    let textx2 = x2 === 0 ? "" : (x2 === 1 ? "+x^2" : (x2 === -1 ? "-x^2" : (x2 > 0 ? `+${x2}x^2` : `${x2}x^2`)));
    let textx3 = x3 === 0 ? "" : (x3 === 1 ? "+x" : (x3 === -1 ? "-x" : (x3 > 0 ? `+${x3}x` : `${x3}x`)));
    let textx4 = x4 === 0 ? "" : (x4 > 0 ? `+${x4}` : `${x4}`);

    correctAnswer = [`${textx1}${textx2}${textx3}${textx4}`];

    return `\\(\\begin{gather}展开:(${tm}x${tn})(${ta}x^2${tb}x${tc}) \\\\ 
    \\begin{array}{|c|c|c|c|} 
    \\hline ${tn} & 囗x^2 & 囗x & 囗1 \\\\ 
    \\hline ${m}x & 囗x^3 & 囗x^2& 囗x \\\\ 
    \\hline   & ${ta}x^2 & ${tb}x & ${tc} \\\\ 
    \\hline \\end{array} \\\\

    \\end{gather}\\)`;
}

function generateB01Level8Question() {
    // 生成一个三次多项式除以一次多项式求余数的题目
    let a = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let b = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let c = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let d = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let e = (Math.floor(Math.random() * 3) + 1) * (Math.random() < 0.5 ? 1 : -1);
    
    // 生成除数 (x + e)
    let texte = e > 0 ? `+${e}` : `${e}`;
    
    // 生成被除式的系数文本，按照数学书写规范
    let texta = a === 1 ? "" : (a === -1 ? "-" : `${a}`);
    let textb = b === 1 ? "+" : (b === -1 ? "-" : (b > 0 ? `+${b}` : `${b}`));
    let textc = c === 1 ? "+" : (c === -1 ? "-" : (c > 0 ? `+${c}` : `${c}`));
    let textd = d > 0 ? `+${d}` : `${d}`;
    
    // 计算余数
    let remainder = a * Math.pow(-e, 3) + b * Math.pow(-e, 2) + c * (-e) + d;
    
    correctAnswer = [`${remainder}`];
    
    return `\\(\\begin{gather}求多项式${texta}x^3${textb}x^2${textc}x${textd}除以(x${texte})的余式 \\\\ 
    提示：被除式可以写成商式\\times除式+余式的形式 \\\\
    即：被除式=(ax^2+bx+c)(x${texte})+R
    \\end{gather}\\)`;
}

function generateB01Level9Question() {
    const levelFunctions = [
        generateB01Level1Question,
        generateB01Level2Question,
        generateB01Level3Question,
        generateB01Level4Question,
        generateB01Level5Question,
        generateB01Level6Question,
        generateB01Level7Question,
        generateB01Level8Question
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

// ========== 二级分组结构 ===========

// ... existing code ...

// ========== B02乘法公式综合题型生成函数 ===========
function generateB02Level1Question() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? -1 : 1);
    let n = (Math.floor(Math.random() * 9) ) * (Math.random() < 0.5 ? -1 : 1);
    let textm = m === 0 ? `` : (m > 0 ? `+${m}` : `${m}`);
    let text2m = 2*m === 0 ? `` : (2*m === 1 ? `+x` : (2*m === -1 ? `-x` : 2*m > 0 ? `+${2*m}x` : `${2*m}x`));
    let textn = n === 0 ? `` : (n > 0 ? `+${n}` : `${n}`);
    let textmmpn = m*m+n === 0 ? `` : (m*m+n > 0 ? `+${m*m+n}` : `${m*m+n}`);

    let qtext = `x^2${text2m}${textmmpn}`;
    correctAnswer = [`(x${textm})^2${textn}`];

    return `\\(\\begin{gather}配方法: 把${qtext} 配成顶点式。\\\\(x+m)^2+n \\\\ 
\\begin{array}{|c|c|c|} 
\\hline ${textm}&${textm}x&${m*m}\\\\ 
\\hline x&x^2&${textm}x \\\\
\\hline  &x &${textm} \\\\
\\hline
\\end{array}  \\end{gather}\\)`;
}

function generateB02Level2aQuestion() {
    let m = (Math.floor(Math.random() * 10) + 1);
    let n = (Math.floor(Math.random() * 5) + 1)*2;
    let mpn = m+4*n;

    let text = n > 0 ? `+${n}` : `${n}`;
    let qtext = `(m-n)^2=${m},mn=${n};\\\\(m+n)^2=?`;
    correctAnswer = [`${mpn}`];

    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level2bQuestion() {
    let m = (Math.floor(Math.random() * 10) + 1);
    let n = (Math.floor(Math.random() * 5) + 1)*2;
    let mpn = m+2*n;

    let text = n > 0 ? `+${n}` : `${n}`;
    let qtext = `(m+n)^2=${mpn },mn=${n/2};\\\\(m-n)^2=?`;
    correctAnswer = [`${m}`];

    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level2cQuestion() {
    let m = (Math.floor(Math.random() * 10) + 1);
    let n = (Math.floor(Math.random() * 5) + 1)*2;
    let mpn = m+2*n;

    let text = n > 0 ? `+${n}` : `${n}`;
    let qtext = `(m+n)^2=${mpn },(m-n)^2=${m};\\\\mn=?`;
    correctAnswer = [`${n/2}`];

    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level2dQuestion() {
    let m = (Math.floor(Math.random() * 10) + 1);
    let n = (Math.floor(Math.random() * 5) + 1)*2;
    let mpn = m+2*n;

    let text = n > 0 ? `+${n}` : `${n}`;
    let qtext = `(m+n)^2=${m },(m-n)^2=${mpn};\\\\mn=?`;
    correctAnswer = [`${-n/2}`];

    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level2Question() {
    const levelFunctions = [
        generateB02Level2aQuestion,
        generateB02Level2bQuestion,
        generateB02Level2cQuestion,
        generateB02Level2dQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB02Level3aQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x+\\frac{1}{x}=${m},\\\\ 则：x^2+\\frac{1}{x^2}=?`;
    correctAnswer = [`${m*m-2}`];
    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level3bQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x-\\frac{1}{x}=${m},\\\\ 则：x^2+\\frac{1}{x^2}=?`;
    correctAnswer = [`${m*m+2}`];
    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level3Question() {
    const levelFunctions = [
        generateB02Level3aQuestion,
        generateB02Level3bQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB02Level4aQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x^2-${m}x-1=0,\\\\ 则：x^2+\\frac{1}{x^2}=?`;
    correctAnswer = [`${m*m+2}`];
    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level4bQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x^2+${m}x+1=0,\\\\ 则：x^2+\\frac{1}{x^2}=?`;
    correctAnswer = [`${m*m-2}`];
    return `\\(\\begin{gather} ${qtext} \\\\ \\end{gather}\\)`;
}

function generateB02Level4Question() {
    const levelFunctions = [
        generateB02Level4aQuestion,
        generateB02Level4bQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB02Level5aQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x^2-${m}x+1=0,\\\\ 则：x^3+\\frac{1}{x^3}=?`;
    correctAnswer = [`${m*(m*m-3)}`];
    return `\\(\\begin{gather} ${qtext} \\\\ 
\\begin{array}{ll}
(x+\\frac{1}{x})^3=x^3+3x+3\\frac{1}{x}+\\frac{1}{x^3}\\\\
x^3+\\frac{1}{x^3}=(x+\\frac{1}{x})(x^2-1+\\frac{1}{x^2}) \\\\
x^3+\\frac{1}{x^3}=(x+\\frac{1}{x})[(x+\\frac{1}{x})^2-3]\\\\
\\end{array}
    \\end{gather}\\)`;
}

function generateB02Level5bQuestion() {
    let m = (Math.floor(Math.random() * 10) + 2);
    let qtext = `若:x^2+${m}x-1=0,\\\\ 则：x^3-\\frac{1}{x^3}=?`;
    correctAnswer = [`${-m*(m*m+3)}`];
    return `\\(\\begin{gather} ${qtext} \\\\    
\\begin{array}{ll}
(x-\\frac{1}{x})^3=x^3-3x+3\\frac{1}{x}-\\frac{1}{x^3}\\\\
x^3-\\frac{1}{x^3}=(x-\\frac{1}{x})(x^2+1+\\frac{1}{x^2}) \\\\
x^3-\\frac{1}{x^3}=(x-\\frac{1}{x})[(x-\\frac{1}{x})^2+3]\\\\
\\end{array}
 \\end{gather}\\)`;
}

function generateB02Level5Question() {
    const levelFunctions = [
        generateB02Level5aQuestion,
        generateB02Level5bQuestion,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

function generateB02Level6Question() {
    const levelFunctions = [
        generateB02Level1Question,
        generateB02Level2Question,
        generateB02Level3Question,
        generateB02Level4Question,
        generateB02Level5Question,
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

// ========== B03因式分解基础题型生成函数 ===========
// 辅助函数：生成指定范围内的随机整数
function randInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function generateB03Level1aQuestion() {
    const factorizationQuestions = [
        { question: "x^2 + 5x + 6", answers: ["(x+2)(x+3)", "(x+3)(x+2)"] },
        { question: "x^2 - x", answers: ["x(x-1)", "(x-1)x"] },
        { question: "x^2 + 2x", answers: ["x(x+2)", "(x+2)x"] },
        { question: "x^2 - 2x", answers: ["x(x-2)", "(x-2)x"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];

    correctAnswer = selectedQuestion.answers;

    return `\\(\\begin{gather}因式分解: ${selectedQuestion.question} \\\\ \\begin{array}{|c|c|c|} \\hline x & x^2 & ax \\\\ \\hline & x & a \\\\ \\hline \\end{array} \\end{gather}\\)`;
}

function generateB03Level1bQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let textm = m === 1 ? "+1" : (m === -1 ? "-1" : (m > 1 ? `+${m}` : `${m}`));
    let textm2 = m === 1 ? "+" : (m === -1 ? "-" : (m > 1 ? `+${m}` : `${m}`));
    correctAnswer = [`x(x${textm})`, `(x${textm})x`];
    return `\\(\\begin{gather}因式分解:x^2${textm2}x \\\\ \\begin{array}{|c|c|c|} \\hline x & x^2 & ax \\\\ \\hline & x & a \\\\ \\hline \\end{array} \\end{gather}\\)`;
}

function generateB03Level1Question() {
    const levelFunctions = [generateB03Level1aQuestion, generateB03Level1bQuestion];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    return levelFunctions[randomIndex]();
}

function generateB03Level2aQuestion() {
    let m = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let mn = m * n;
    let textm = m === 1 ? "+1" : (m === -1 ? "-1" : (m > 1 ? `+${m}` : `${m}`));
    let textn = n === 1 ? "" : (n === -1 ? "-" : (n > 1 ? `${n}` : `${n}`));
    let textmn = mn === 1 ? "+" : (mn === -1 ? "-" : (mn > 1 ? `+${mn}` : `${mn}`));
    correctAnswer = [`${textn}x(x${textm})`, `(x${textm})${textn}x`];
    return `\\(\\begin{gather}因式分解:${textn}x^2${textmn}x \\\\ \\begin{array}{|c|c|c|} \\hline bx & x^2 & abx \\\\ \\hline & x & a \\\\ \\hline \\end{array} \\end{gather}\\)`;
}

function generateB03Level2Question() {
    return generateB03Level2aQuestion();
}

function generateB03Level3aQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let textm = m > 0 ? `+${m}` : `${m}`;
    let p = m + m;
    let t = m * m;
    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`(x${textm})(x${textm})`, `(x${textm})^2`];
    return `\\(\\begin{gather}因式分解:x^2${textp}${textt} \\\\ \\begin{array}{|c|c|c|} \\hline b&bx& ${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB03Level3bQuestion() {
    let m = (Math.floor(Math.random() * 9) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = -m;
    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;
    let t = m * m;
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`(x${textm})(x${textn})`, `(x${textn})(x${textm})`];
    return `\\(\\begin{gather}因式分解:x^2 - ${t}\\\\ \\begin{array}{|c|c|c|} \\hline b&bx& -${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB03Level3Question() {
    const levelFunctions = [generateB03Level3aQuestion, generateB03Level3bQuestion];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    return levelFunctions[randomIndex]();
}

function generateB03Level4aQuestion() {
    let m = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let n = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let textm = m > 0 ? `+${m}` : `${m}`;
    let textn = n > 0 ? `+${n}` : `${n}`;
    let p = m + n;
    let t = m * n;
    let textp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 1 ? `+${p}x` : `${p}x`)));
    let textt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`(x${textm})(x${textn})`, `(x${textn})(x${textm})`];
    if (m === n) correctAnswer.push(`(x${textm})^2`);
    return `\\(\\begin{gather}因式分解:x^2${textp}${textt} \\\\ \\begin{array}{|c|c|c|} \\hline b&bx& ${textt}\\\\ \\hline x & x^2 &ax \\\\ \\hline  &x&a \\\\ \\hline  \\end{array} \\end{gather}\\)`;
}

function generateB03Level4Question() {
    return generateB03Level4aQuestion();
}

function generateB03Level5cQuestion() {
    let a, b, m, n;
    do {
        a = (Math.floor(Math.random() * 6) + 2);
        b = (Math.floor(Math.random() * 6) + 2) * (Math.random() < 0.5 ? 1 : -1);
    } while (gcd(a, Math.abs(b)) !== 1);
    do {
        m = (Math.floor(Math.random() * 6) + 2);
        n = (Math.floor(Math.random() * 6) + 2) * (Math.random() < 0.5 ? 1 : -1);
    } while (gcd(m, Math.abs(n)) !== 1);
    while (a * n === b * m) {
        m = (Math.floor(Math.random() * 8) + 2);
        n = (Math.floor(Math.random() * 8) + 2) * (Math.random() < 0.5 ? 1 : -1);
    }
    const coeffA = a * m;
    const coeffB = a * n + b * m;
    const coeffC = b * n;
    correctAnswer = [`(${a}x${b >= 0 ? '+' : ''}${b})(${m}x${n >= 0 ? '+' : ''}${n})`, `(${m}x${n >= 0 ? '+' : ''}${n})(${a}x${b >= 0 ? '+' : ''}${b})`];
    let expression = `${coeffA}x^2`;
    if (coeffB !== 0) expression += `${coeffB > 0 ? '+' : ''}${coeffB}x`;
    expression += `${coeffC > 0 ? '+' : ''}${coeffC}`;
    let table = `\\begin{array}{|c|c|c|}  
\\hline 
b & bmx & ${coeffC} \\\\ \\hline 
ax & ${coeffA}x^2 & ${a}n x \\\\ \\hline 
& mx & n \\\\ \\hline 
\\end{array}`;
    return `\\begin{gather}
因式分解: ${expression} \\\\ 
${table} 
\\end{gather}`;
}

function generateB03Level5Question() {
    return generateB03Level5cQuestion();
}

function generateB03Level6aQuestion() {
    let a, b, c;
    // 直到三根互不相同
    do {
        a = randInt(1, 3) * (Math.random() < .5 ? 1 : -1); // ±1…±3
        b = randInt(1, 3);                                  // 1…3
        c = randInt(-3, -1);                                // –3…–1
    } while (new Set([a, b, c]).size !== 3);
    let ta = a === 0 ? "" : (a > 0 ? `+${a}` : `${a}`);
    let tb = b === 0 ? "" : (b > 0 ? `+${b}` : `${b}`);
    let tc = c === 0 ? "" : (c > 0 ? `+${c}` : `${c}`);
    let x1 = a + b + c;
    let x2 = a * b + b * c + c * a;
    let x3 = a * b * c;
    let textx1 = x1 === 0 ? "" : (x1 === 1 ? "+x^2" : (x1 === -1 ? "-x^2" : (x1 > 0 ? `+${x1}x^2` : `${x1}x^2`)));
    let textx2 = x2 === 0 ? "" : (x2 === 1 ? "+x" : (x2 === -1 ? "-x" : (x2 > 0 ? `+${x2}x` : `${x2}x`)));
    let textx3 = x3 === 0 ? "" : (x3 > 0 ? `+${x3}` : `${x3}`);
    correctAnswer = [
        `(x${ta})(x${tb})(x${tc})`,
        `(x${ta})(x${tc})(x${tb})`,
        `(x${tb})(x${ta})(x${tc})`,
        `(x${tb})(x${tc})(x${ta})`,
        `(x${tc})(x${ta})(x${tb})`,
        `(x${tc})(x${tb})(x${ta})`
    ];
    return `\\(\\begin{gather}因式分解:x^3${textx1}${textx2}${textx3} \\\\ \\begin{array}{|c|c|c|c|} \\hline x^3&x^2&x&1\\\\ \\hline 1 &${x1} &${x2}&${x3} \\\\ \\hline1& a+b+c & ab+bc+ac&abc\\\\ \\hline \\end{array}\\\\
\\begin{cases}a+b+c=${x1}\\\\ab+bc+ac=${x2}\\\\abc=${x3}\\\\ \\end{cases}\\\\
分组分解，拆添项，试根法......
\\end{gather}\\)`;
}

function generateB03Level6bQuestion() {
    let a = (Math.floor(Math.random() * 5) + 1) * (Math.random() < 0.5 ? 1 : -1);
    let b = a;
    let c = a;
    let ta = a === 0 ? "" : (a > 0 ? `+${a}` : `${a}`);
    let x1 = a + b + c;
    let x2 = a * b + b * c + c * a;
    let x3 = a * b * c;
    let textx1 = x1 === 0 ? "" : (x1 === 1 ? "+x^2" : (x1 === -1 ? "-x^2" : (x1 > 0 ? `+${x1}x^2` : `${x1}x^2`)));
    let textx2 = x2 === 0 ? "" : (x2 === 1 ? "+x" : (x2 === -1 ? "-x" : (x2 > 0 ? `+${x2}x` : `${x2}x`)));
    let textx3 = x3 === 0 ? "" : (x3 > 0 ? `+${x3}` : `${x3}`);
    correctAnswer = [`(x${ta})^3`];
    return `\\(\\begin{gather}因式分解:x^3${textx1}${textx2}${textx3} \\\\ \\begin{array}{|c|c|c|c|} \\hline x^3&x^2&x&1\\\\ \\hline 1 &${x1} &${x2}&${x3} \\\\ \\hline1& a+b+c & ab+bc+ac&abc\\\\ \\hline \\end{array}\\\\
\\begin{cases}a+b+c=${x1}\\\\ab+bc+ac=${x2}\\\\abc=${x3}\\\\ \\end{cases}\\\\
分组分解，拆添项，试根法......
\\end{gather}\\)`;
}

function generateB03Level6Question() {
    const levelFunctions = [generateB03Level6aQuestion, generateB03Level6bQuestion];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    return levelFunctions[randomIndex]();
}

function generateB03Level7aQuestion() {
    let km = (Math.floor(Math.random() * 10) + 0);
    let kn = (Math.floor(Math.random() * 8) + 1);
    let n = (km + kn) % 10 + 1;
    let m = km + 1;
    let p = -(m + n);
    let t = m * n;
    let tp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 0 ? `+${p}x` : `${p}x`)));
    let tt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`${m},${n}`, `${n},${m}`, `${m};${n}`, `${n};${m}`];
    return `\\(\\begin{gather}解方程: x^2 ${tp} ${tt} = 0 \\\\
\\begin{array}{|c|c|c|}
\\hline b & bx & ab \\\\ \\hline x & x^2 & ax \\\\ \\hline & x & a \\\\ \\hline 
\\end{array}\\\\
输入格式：a,b或a;b\\\\因式分解是解方程的一种常用方法，试试吧，\\\\当然你还可以用求根公式、配方法等......
\\end{gather}\\)`;
}

function generateB03Level7bQuestion() {
    let km = (Math.floor(Math.random() * 10) + 0);
    let kn = (Math.floor(Math.random() * 8) + 1);
    let n = (km + kn) % 10 - 5;
    let m = km - 5;
    let p = -(m + n);
    let t = m * n;
    let tp = p === 0 ? "" : (p === 1 ? "+x" : (p === -1 ? "-x" : (p > 0 ? `+${p}x` : `${p}x`)));
    let tt = t === 0 ? "" : (t > 0 ? `+${t}` : `${t}`);
    correctAnswer = [`${m},${n}`, `${n},${m}`, `${m};${n}`, `${n};${m}`];
    return `\\(\\begin{gather}解方程: x^2 ${tp} ${tt} = 0 \\\\
\\begin{array}{|c|c|c|}
\\hline b & bx & ab \\\\ \\hline x & x^2 & ax \\\\ \\hline & x & a \\\\ \\hline 
\\end{array}\\\\
输入格式：x_1,x_2或x_1;x_2\\\\因式分解是解方程的一种常用方法，试试吧，\\\\当然你还可以用求根公式、配方法等......
\\end{gather}\\)`;
}

function generateB03Level7Question() {
    const levelFunctions = [generateB03Level7aQuestion, generateB03Level7bQuestion];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    return levelFunctions[randomIndex]();
}

function generateB03Level8Question() {
    const a = 1;
    const c = 1;
    const options = [-3, -2, -1, 1, 2, 3];
    const b = options[3];
    const d = options[3];
    const e = options[Math.floor(Math.random() * options.length)];
    const f = options[Math.floor(Math.random() * options.length)];

    const coeffX2 = a * c;
    const coeffXY = a * d + b * c;
    const coeffY2 = b * d;
    const coeffX = a * f + e * c;
    const coeffY = b * f + e * d;
    const constant = e * f;

    let expression = '';
    if (coeffX2 !== 0) expression += (coeffX2 === 1 ? '' : (coeffX2 === -1 ? '-' : coeffX2)) + 'x^2';
    if (coeffXY !== 0) expression += (coeffXY > 0 ? '+' : '') + (coeffXY === 1 ? '' : (coeffXY === -1 ? '-' : coeffXY)) + 'xy';
    if (coeffY2 !== 0) expression += (coeffY2 > 0 ? '+' : '') + (coeffY2 === 1 ? '' : (coeffY2 === -1 ? '-' : coeffY2)) + 'y^2';
    if (coeffX !== 0) expression += (coeffX > 0 ? '+' : '') + (coeffX === 1 ? '' : (coeffX === -1 ? '-' : coeffX)) + 'x';
    if (coeffY !== 0) expression += (coeffY > 0 ? '+' : '') + (coeffY === 1 ? '' : (coeffY === -1 ? '-' : coeffY)) + 'y';
    if (constant !== 0) expression += (constant > 0 ? '+' : '') + constant;
    if (expression === '') expression = '0';

    const part1 = `${a === 1 ? '' : a}x${b > 0 ? '+' : ''}${b === 1 ? '' : (b === -1 ? '-' : b)}y${e >= 0 ? '+' : ''}${e}`;
    const part2 = `${c === 1 ? '' : c}x${d > 0 ? '+' : ''}${d === 1 ? '' : (d === -1 ? '-' : d)}y${f >= 0 ? '+' : ''}${f}`;
    correctAnswer = [`(${part1})(${part2})`, `(${part2})(${part1})`];
    
    // 如果两个因式相同，添加平方形式作为有效答案
    if (part1 === part2) {
        correctAnswer.push(`(${part1})^2`);
    }

    return `\\(\\begin{array} 请因式分解: ${expression} \\\\ \\text{提示：将表达式分解为两个线性因子的乘积，} \\\\例如 (ax+by+c)(dx+ey+f)\\end{array}\\)`;
}

function generateB03Level9Question() {
    const a = Math.floor(Math.random() * 2) + 1;
    const c = Math.floor(Math.random() * 2) + 1;
    const options = [ -1, 1, 3,5];
    const b = options[Math.floor(Math.random() * options.length)];
    const d = options[Math.floor(Math.random() * options.length)];
    const e = options[Math.floor(Math.random() * options.length)];
    const f = options[Math.floor(Math.random() * options.length)];

    const coeffX2 = a * c;
    const coeffXY = a * d + b * c;
    const coeffY2 = b * d;
    const coeffX = a * f + e * c;
    const coeffY = b * f + e * d;
    const constant = e * f;

    let expression = '';
    if (coeffX2 !== 0) expression += (coeffX2 === 1 ? '' : (coeffX2 === -1 ? '-' : coeffX2)) + 'x^2';
    if (coeffXY !== 0) expression += (coeffXY > 0 ? '+' : '') + (coeffXY === 1 ? '' : (coeffXY === -1 ? '-' : coeffXY)) + 'xy';
    if (coeffY2 !== 0) expression += (coeffY2 > 0 ? '+' : '') + (coeffY2 === 1 ? '' : (coeffY2 === -1 ? '-' : coeffY2)) + 'y^2';
    if (coeffX !== 0) expression += (coeffX > 0 ? '+' : '') + (coeffX === 1 ? '' : (coeffX === -1 ? '-' : coeffX)) + 'x';
    if (coeffY !== 0) expression += (coeffY > 0 ? '+' : '') + (coeffY === 1 ? '' : (coeffY === -1 ? '-' : coeffY)) + 'y';
    if (constant !== 0) expression += (constant > 0 ? '+' : '') + constant;
    if (expression === '') expression = '0';

    const part1 = `${a === 1 ? '' : a}x${b > 0 ? '+' : ''}${b === 1 ? '' : (b === -1 ? '-' : b)}y${e >= 0 ? '+' : ''}${e}`;
    const part2 = `${c === 1 ? '' : c}x${d > 0 ? '+' : ''}${d === 1 ? '' : (d === -1 ? '-' : d)}y${f >= 0 ? '+' : ''}${f}`;
    correctAnswer = [`(${part1})(${part2})`,`(${part2})(${part1})`];
    
    // 如果两个因式相同，添加平方形式作为有效答案
    if (part1 === part2) {
        correctAnswer.push(`(${part1})^2`);
    }

    return `\\(\\begin{array} 请因式分解: ${expression} \\\\ \\text{提示：将表达式分解为两个线性因子的乘积，} \\\\例如 (ax+by+c)(dx+ey+f)\\end{array}\\)`;
}

function generateB03Level10Question() {
    const levelFunctions = [
        generateB03Level1Question,
        generateB03Level2Question,
        generateB03Level3Question,
        generateB03Level4Question,
        generateB03Level5Question,
        generateB03Level6Question,
        generateB03Level7Question,
        generateB03Level8Question,
        generateB03Level9Question,
    ];
    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    return levelFunctions[randomIndex]();
}

// ========== B04因式分解技巧题型生成函数 ===========
function generateB04Level1Question() {
    const factorizationQuestions = [
        { question: "3x^2 + 6x", answers: ["3x(x+2)"] },
        { question: "4x^3 - 8x^2", answers: ["4x^2(x-2)"] },
        { question: "5x^2y - 10xy^2 + 5xy", answers: ["5xy(x-2y+1)"] },
        { question: "a(x-a) + b(a-x) - (x-a)", answers: ["(x-a)(a-b-1)"] },
        { question: "-2x(x+1) + a(x+1) + (x+1)", answers: ["(x+1)(-2x+a+1)"] },
        { question: "\\frac{3}{2}b^{3n+1} + \\frac{1}{6}b^{2n-1} (n 是正整数)", answers: ["\\frac{1}{6}b^{2n-1}(9b^n+1)"] },
        { question: "2(p-1)^2 - 4q(p-1)", answers: ["2(p-1)(p-1-2q)"] },
        { question: "mn(m^2 + n^2) - n^2(m^2 + n^2)", answers: ["n(m^2+n^2)(m-n)"] },
        { question: "(5a-2b)(2m+3p) - (2a-7b)(2m+3p)", answers: ["(2m+3p)(3a+5b)"] },
        { question: "2(x+y) + 6(x+y)^2 - 4(x+y)^3", answers: ["2(x+y)(1+3(x+y)-2(x+y)^2)"] },
        { question: "(x+y)^2(b+c) - (x+y)(b+c)^2", answers: ["(x+y)(b+c)(x+y-b-c)"] },
        { question: "6p(x-1)^3 - 8p^2(x-1)^2 - 2p(1-x)^2", answers: ["2p(x-1)^2(3x-4p-4)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level2Question() {
    const factorizationQuestions = [
        { question: "16 - (3a + 2b)^2", answers: ["(4 + 3a + 2b)(4 - 3a - 2b)"] },
        { question: "4y^2 - (2z - x)^2", answers: ["(2y + 2z - x)(2y - 2z + x)"] },
        { question: "a^4 - b^4", answers: ["(a^2 + b^2)(a + b)(a-b)","(a^2 + b^2)(a - b)(a+b)"] },
        { question: "- 81a^4b^4 + 16c^4", answers: ["(4c^2+9a^2b^2  )(2c+3ab)(2c-3ab)","(9a^2b^2+4c^2  )(3ab+2c)(3ab-2c)"] },
        { question: "20a^3x^3 - 45axy^2", answers: ["5ax(a + y)(2ax - 3y)"] },
        { question: "(3a^2 - b^2)^2 - (a^2 - 3b^2)^2", answers: ["(a^2 + 3b^2)(2a^2 - 9b^2)"] },
        { question: "x^8 - y^8", answers: ["(x^4 + y^4)(x^2 + y^2)(x + y)(x - y)"] },
        { question: "16x^5 - x", answers: ["x(2x + 1)(2x - 1)(2x^2 + 1)"] },
        { question: "(5x^2 + 2x - 3)^2 - (x^2 - 2x - 3)^2", answers: ["24x(2x + 1)(x - 1)"] },
        { question: "32a^3b^3 - 4b^9", answers: ["4b^3(2a + b)(4a^2 - 2ab + b^2)"] },
        { question: "8a^3b^3c^3 - 1", answers: ["(2abc - 1)(4a^2b^2c^2 + 2abc + 1)"] },
        { question: "64x^6y^3 + y^15", answers: ["y^3(4x^2 + y^2)(4x^4 - 4x^2y^2 + y^4)"] },
        { question: "x^2(a + b)^2 - 2xy(a^2 - b^2) + y^2(a - b)^2", answers: ["[x(a + b) - y(a - b)]^2"] },
        { question: "a^n+2 + 8a^n + 16a^n-2", answers: ["a^n(a^2 + 4)^2"] },
        { question: "9a^2 + x^2n + 6a + 6ax^n + 1", answers: ["(a + 1)^2 + 3(a + 1)x^n + x^2n"] },
        { question: "a^2 + b^2 + c^2 + 2ab - 2ac - 2bc", answers: ["(a + b - c)^2"] },
        { question: "x^2 + y^2 + 4z^2 - 6xy + 4xz - 12yz", answers: ["(x - y - z)^2 + 2(x - z)^2"] },
        { question: "(p + q)^3 - 3(p + q)^2(p - q) + 3(p + q)(p - q)^2 - (p - q)^3", answers: ["8q^3"] },
        { question: "4a^2b^2 - (a^2 + b^2)^2", answers: ["(2ab - a^2 - b^2)(2ab + a^2 + b^2)"] },
        { question: "(a + x)^4 - (a - x)^4", answers: ["8ax(a^2 + x^2)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level3Question() {
    const factorizationQuestions = [
        { question: "ax - ay + bx + cy - cx - by", answers: ["(x-y)(a+b-c)", "(a+b-c)(x-y)"] },
        { question: "x^4 + x^3 + x^2 - 1", answers: ["(x+1)(x^3+x-1)", "(x^3+x-1)(x+1)"] },
        { question: "a(1 - b + b^2) - 1 + b - b^2", answers: ["(1-b+b^2)(a-1)", "(a-1)(1-b+b^2)"] },
        { question: "4x(a^2 + x^2) - a^2 - x^2", answers: ["(a^2+x^2)(4x-1)", "(4x-1)(a^2+x^2)"] },
        { question: "abx^2 + bxy - axy - y^2", answers: ["(bx-y)(ax+y)", "(ax+y)(bx-y)"] },
        { question: "a^2b^3 - abc^2d + ab^2cd - c^3d^2", answers: ["(ab-cd)(ab^2-c^2d)", "(ab^2-c^2d)(ab-cd)"] },
        { question: "32ac^2 + 15cx^2 - 48ax^2 - 10c^3", answers: ["(2c^2-3x^2)(16a-5c)", "(16a-5c)(2c^2-3x^2)"] },
        { question: "2(x^2 - 3ab) + x(4a - 3b)", answers: ["(x+2a)(2x-3b)", "(2x-3b)(x+2a)"] },
        { question: "x^3 - x + y^3 - y", answers: ["(x+y)(x^2-xy+y^2-1)", "(x^2-xy+y^2-1)(x+y)"] },
        { question: "x^3 + y^3 + x^2 + 2xy + y^2", answers: ["(x+y)(x^2-xy+y^2+x+y)", "(x^2-xy+y^2+x+y)(x+y)"] },
        { question: "4a^2 - b^2 + c^2 - 9d^2 + 4ac + 6bd", answers: ["(2a+c+b-3d)(2a+c-b+3d)", "(2a+c-b+3d)(2a+c+b-3d)"] },
        { question: "a(1 - b)^2 - 1 + 2b - b^2", answers: ["(1-b)^2(a-1)", "(a-1)(1-b)^2"] },
        { question: "x(x + z) - y(y + z)", answers: ["(x-y)(x+y+z)", "(x+y+z)(x-y)"] },
        { question: "3x + bx^2 + ax + ab", answers: ["(x+b)(x^2+a)", "(x^2+a)(x+b)"] },
        { question: "acx^3 + bcx^2 + adx + bd", answers: ["(ax+b)(cx^2+d)", "(cx^2+d)(ax+b)"] },
        { question: "a^4 + a^3b - ab^3 - b^4", answers: ["(a+b)(a-b)(a^2+ab+b^2)", "(a-b)(a+b)(a^2+ab+b^2)"] },
        { question: "a^4 - a^3b - ab^3 + b^4", answers: ["(a-b)^2(a^2+ab+b^2)", "(a^2+ab+b^2)(a-b)^2"] },
        { question: "4a^2b^2 - a^2 - b^2 + 1", answers: ["(a^2+b^2-1)(2ab+1)", "(2ab+1)(a^2+b^2-1)"] },
        { question: "x^2y^2z^2 - x^2z^2 - y^2z^2 + z^4", answers: ["(x-z)(x+z)(y+z)(y-z)", "(x+z)(x-z)(y-z)(y+z)"] },
        { question: "x^2y^2z^2 - x^2z^2 - y^2z^2 + x^4", answers: ["(y^2z-1)(x^2z-1)", "(x^2z-1)(y^2z-1)"] },
        { question: "(a+b)^2 + (a+c)^2 - (c+d)^2 - (b+d)^2", answers: ["2(a+b+c+d)(a-d)", "2(a-d)(a+b+c+d)"] },
        { question: "ax(y^3 + b^3) + by(bx^2 + a^2y)", answers: ["b(x^2+a^2)(xy+ab)", "(xy+ab)b(x^2+a^2)"] },
        { question: "(a+b)^3 + (b+c)^3 + (c+a)^3 + a^3 + b^3 + c^3", answers: ["3(a+b+c)(a^2+b^2+c^2)", "3(a^2+b^2+c^2)(a+b+c)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level4Question() {
    const factorizationQuestions = [
        { question: "x^4 - 3x^2 + 1", answers: ["(x^2 + x - 1)(x^2 - x - 1)", "(x^2 - x - 1)(x^2 + x - 1)"] },
        { question: "x^4 - 7x^2y^2 + 81y^4", answers: ["(x^2 + 5xy + 9y^2)(x^2 - 5xy + 9y^2)", "(x^2 - 5xy + 9y^2)(x^2 + 5xy + 9y^2)"] },
        { question: "x^4 - 23x^2 + 1", answers: ["(x^2 + 5x + 1)(x^2 - 5x + 1)", "(x^2 - 5x + 1)(x^2 + 5x + 1)"] },
        { question: "-14x^2y^2 + x^4 + y^4", answers: ["(x^2 + 4xy + y^2)(x^2 - 4xy + y^2)", "(x^2 - 4xy + y^2)(x^2 + 4xy + y^2)"] },
        { question: "x^8 + x^4 + 1", answers: ["(x^2 - x + 1)(x^2 + x + 1)(x^4 - x^2 + 1)", "(x^4 - x^2 + 1)(x^2 + x + 1)(x^2 - x + 1)"] },
        { question: "x^4 - 47x^2 + 1", answers: ["(x^2 + 7x + 1)(x^2 - 7x + 1)", "(x^2 - 7x + 1)(x^2 + 7x + 1)"] },
        { question: "x^{12} - 33x^6 + 1", answers: ["(x^6 + x^3 - 1)(x^6 - x^3 - 1)", "(x^6 - x^3 - 1)(x^6 + x^3 - 1)"] },
        { question: "x^3(a + 1) - xy(x - y)(a - b) + y^3(b + 1)", answers: ["(x-y)(xy+y^2)(ax+by+x+y)", "(ax+by+x+y)(x-y)(xy+y^2)"] },
        { question: "x^2 - y^2 + 2x + 6y - 8", answers: ["(x+y-2)(x-y+4)", "(x-y+4)(x+y-2)"] },
        { question: "x^4 + 2^6", answers: ["(x^2 + 4x + 8)(x^2 - 4x + 8)", "(x^2 - 4x + 8)(x^2 + 4x + 8)"] },
        { question: "1 - 2ax - (c - a^2)x^2 + acx^3", answers: ["(1 - ax)(1 - ax - cx^2)", "(1 - ax - cx^2)(1 - ax)"] },
        { question: "2x^3 - 4x^2y - x^2z + 2xy^2 + 2xyz - y^2z", answers: ["(x-y)^2(2x-z)", "(2x-z)(x-y)^2"] },
        { question: "x^4 + 6x^2 + 25", answers: ["(x^2 + 3x + 5)(x^2 - 3x + 5)", "(x^2 - 3x + 5)(x^2 + 3x + 5)"] },
        { question: "x^4 - 10x^2 + 9", answers: ["(x^2 + x - 3)(x^2 - x - 3)", "(x^2 - x - 3)(x^2 + x - 3)"] },
        { question: "x^4 + x^2y^2 + 25y^4", answers: ["(x^2 + 3xy + 5y^2)(x^2 - 3xy + 5y^2)", "(x^2 - 3xy + 5y^2)(x^2 + 3xy + 5y^2)"] },
        { question: "x^4 - 15x^2 + 16", answers: ["(x^2 + 4x + 4)(x^2 - 4x + 4)", "(x^2 - 4x + 4)(x^2 + 4x + 4)"] },
        { question: "x^8 + 4x^4 + 16", answers: ["(x^4 + 2x^2 + 4)(x^4 - 2x^2 + 4)", "(x^4 - 2x^2 + 4)(x^4 + 2x^2 + 4)"] },
        { question: "x^4 - 50x^2 + 49", answers: ["(x^2 + 7x - 7)(x^2 - 7x - 7)", "(x^2 - 7x - 7)(x^2 + 7x - 7)"] },
        { question: "x^4 - 12x^2 + 36", answers: ["(x^2 + 2x - 6)(x^2 - 2x - 6)", "(x^2 - 2x - 6)(x^2 + 2x - 6)"] },
        { question: "x^6 - 14x^3y^3 + y^6", answers: ["(x^2 + 3xy + y^2)(x^2 - 3xy + y^2)(x^2 + xy + y^2)", "(x^2 + xy + y^2)(x^2 + 3xy + y^2)(x^2 - 3xy + y^2)"] },
        { question: "a^2 - b^2 + 6a + 4b - 5", answers: ["(a + b - 1)(a - b + 5)", "(a - b + 5)(a + b - 1)"] },
        { question: "x^6 + 27", answers: ["(x^2 + 3x + 3)(x^2 - 3x + 3)(x^2 + 3)", "(x^2 - 3x + 3)(x^2 + 3x + 3)(x^2 + 3)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level5Question() {
    const factorizationQuestions = [
        { question: "x^2 + 12x + 20", answers: ["(x+2)(x+10)", "(x+10)(x+2)"] },
        { question: "x^2 - 12x + 20", answers: ["(x-2)(x-10)", "(x-10)(x-2)"] },
        { question: "x^2 - 4x - 5", answers: ["(x+1)(x-5)", "(x-5)(x+1)"] },
        { question: "x^2 - 9x - 22", answers: ["(x-11)(x+2)", "(x+2)(x-11)"] },
        { question: "12x^2 - 11xy - 15y^2", answers: ["(4x+3y)(3x-5y)", "(3x-5y)(4x+3y)"] },
        { question: "6x^2 - 13x + 6", answers: ["(2x-3)(3x-2)", "(3x-2)(2x-3)"] },
        { question: "2x^2 + 7x + 3", answers: ["(2x+3)(x+1)", "(x+1)(2x+3)"] },
        { question: "2x^2 - 5x + 3", answers: ["(2x-3)(x-1)", "(x-1)(2x-3)"] },
        { question: "-20xy + 64y^2 + x^2", answers: ["(x-4y)(x-16y)", "(x-16y)(x-4y)"] },
        { question: "-x^2 + x + 56", answers: ["-(x+7)(x-8)", "-(x-8)(x+7)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level6Question() {
    const factorizationQuestions = [
        { question: "x^2 + 2xy + y^2 + 3x + 3y + 2", answers: ["(x+y+1)(x+y+2)", "(x+y+2)(x+y+1)"] },
        { question: "4x^2 - 14xy + 6y^2 - 7x + y - 2", answers: ["(4x-2y+1)(x-3y-2)", "(x-3y-2)(4x-2y+1)"] },
        { question: "x^2 - y^2 - 3x^2 - 2xx + 4yz", answers: ["(x+y-3z)(x-y+z)", "(x-y+z)(x+y-3z)"] },
        { question: "2y^2 - 5xy + 2x^2 - ay - ax - a^2", answers: ["(x-2y-a)(2x-y+a)", "(2x-y+a)(x-2y-a)"] },
        { question: "a^2 - 3b^2 - 3c^2 + 10bc - 2ca - 2ab", answers: ["(a+b-3c)(a-3b+c)", "(a-3b+c)(a+b-3c)"] },
        { question: "6a^2 - 7ab - 22b^2 - 5a + 35b - 3", answers: ["(a+2b-3)(2a-11b+1)", "(2a-11b+1)(a+2b-3)"] },
        { question: "x^2 - 2y^2 - 3z^2 + xy + 7yz + 2xz", answers: ["(x-y+3z)(x+2y-z)", "(x+2y-z)(x-y+3z)"] },
        { question: "x^2 - 6y^2 + 3z^2 - xy + 7zx + 7yz", answers: ["(x-2y+3z)(2x+3y+z)", "(2x+3y+z)(x-2y+3z)"] },
        { question: "4x^2 - 9y^2 + 2x^2 + 6xz - 3yz", answers: ["(2x+3y+2z)(2x-3y+z)", "(2x-3y+z)(2x+3y+2z)"] },
        { question: "4x^2 + 2x^2 + xy + 9zx + 2yz", answers: ["(x+2z)(4x+y+z)", "(4x+y+z)(x+2z)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level7Question() {
    const factorizationQuestions = [
        { question: "x^4 - 10x^2y^2 + 9y^4", answers: ["(x-y)(x+y)(x-3y)(x+3y)", "(x-3y)(x+3y)(x-y)(x+y)"] },
        { question: "x^6 - 19x^3y^3 - 216y^6", answers: ["(x+2y)(x-3y)(x^2-2xy+4y^2)(x^2+3xy+9y^2)", "(x-3y)(x+2y)(x^2+3xy+9y^2)(x^2-2xy+4y^2)"] },
        { question: "x^4 + 4x^3 + 4x^2 - 9", answers: ["(x^2+2x+3)(x^2+2x-3)", "(x^2+2x-3)(x^2+2x+3)"] },
        { question: "x^4 - 2x^3 - 11x^2 + 12x + 36", answers: ["(x+2)^2(x-3)^2", "(x-3)^2(x+2)^2"] },
        { question: "x^5 + x^4 - 5x^3 - x^2 + 8x - 4", answers: ["(x-1)^2(x+2)^2(x+1)", "(x+1)(x-1)^2(x+2)^2"] },
        { question: "x^6 - 7x^3 - 8", answers: ["(x-2)(x^2+2x+4)(x+1)(x^2-x+1)", "(x+1)(x^2-x+1)(x-2)(x^2+2x+4)"] },
        { question: "x^8 - 1", answers: ["(x-1)(x+1)(x^2+1)(x^4+1)", "(x^4+1)(x^2+1)(x+1)(x-1)"] },
        { question: "(x^2+x+1)(x^2+x+2)-12", answers: ["(x^2+x-2)(x^2+x+5)", "(x^2+x+5)(x^2+x-2)"] },
        { question: "(x+1)(x+2)(x+3)(x+4)-24", answers: ["(x^2+5x+5)^2-1", "(x^2+5x+4)(x^2+5x+6)"] },
        { question: "x^4+x^2y^2+y^4", answers: ["(x^2+xy+y^2)(x^2-xy+y^2)", "(x^2-xy+y^2)(x^2+xy+y^2)"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level8Question() {
    const factorizationQuestions = [
        { question: "x^3 - 3x + 2", answers: ["(x-1)^2(x+2)", "(x+2)(x-1)^2"] },
        { question: "x^3 + 4x^2 + 5x + 2", answers: ["(x+1)^2(x+2)", "(x+2)(x+1)^2"] },
        { question: "x^3 - 7x + 6", answers: ["(x-1)(x-2)(x+3)", "(x+3)(x-2)(x-1)"] },
        { question: "x^3 + x^2 - 10x + 8", answers: ["(x-1)(x-2)(x+4)", "(x+4)(x-2)(x-1)"] },
        { question: "x^3 - 6x^2 + 11x - 6", answers: ["(x-1)(x-2)(x-3)", "(x-3)(x-2)(x-1)"] },
        { question: "x^3 + 3x^2 - 4", answers: ["(x-1)(x+2)^2", "(x+2)^2(x-1)"] },
        { question: "x^3 - x^2 - x + 1", answers: ["(x-1)^2(x+1)", "(x+1)(x-1)^2"] },
        { question: "x^3 + 2x^2 - 5x - 6", answers: ["(x+1)(x-2)(x+3)", "(x+3)(x-2)(x+1)"] },
        { question: "x^3 - 3x^2 - 9x + 27", answers: ["(x-3)^2(x+3)", "(x+3)(x-3)^2"] },
        { question: "x^3 + 6x^2 + 12x + 8", answers: ["(x+2)^3"] }
    ];

    const randomIndex = Math.floor(Math.random() * factorizationQuestions.length);
    const selectedQuestion = factorizationQuestions[randomIndex];
    correctAnswer = selectedQuestion.answers;

    return `\\(因式分解:${selectedQuestion.question} \\)`;
}

function generateB04Level9Question() {
    const levelFunctions = [
        generateB04Level1Question,
        generateB04Level2Question,
        generateB04Level3Question,
        generateB04Level4Question,
        generateB04Level5Question,
        generateB04Level6Question,
        generateB04Level7Question,
        generateB04Level8Question
    ];

    const randomIndex = Math.floor(Math.random() * levelFunctions.length);
    const selectedFunction = levelFunctions[randomIndex];

    return selectedFunction();
}

</script>
</body>
</html>

