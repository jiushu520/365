<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML5 Canvas Drawing</title>
    <style>
        canvas {
            border: 1px solid black;
            background-color: #FFFFE0; /* 设置背景为淡黄色 */
            display: block;
            margin: 20px auto;
        }
        .tool-bar {
            text-align: center;
            margin-bottom: 10px;
        }
        .tool-bar button {
            margin: 0 10px;
            padding: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .tool-bar button.active {
            background-color: #FFFFE0; /* 高亮显示的背景色 */
            border: 1px solid #000000; /* 高亮显示的边框 */
        }
        /* 使用自定义光标 */
        .custom-cursor {
            cursor: url('data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHZpZXdCb3g9IjAgMCAzMCAzMCIgdmVyc2lvbj0iMSIgd2lsdHJhdmVsb3Blbl9mZ24iIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGc+PGNpcmNsZSByPSIxNSIgY3g9IjE1IiBjeT0iMTUiIHN0eWxlPSJmaWxsOmNhcjsiIC8+PC9nPjwvc3ZnPg=='), auto;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">玖数草稿</h1>
    <div class="tool-bar">
        <button id="pen" class="active">画笔</button>
        <button id="eraser">橡皮</button>
        <button id="clear">清除</button><br><br>
        <button id="black" style="background-color: black; color: white;">黑</button>
        <button id="red" style="background-color: red;">红</button>
        <button id="blue" style="background-color: blue; color: white;">蓝</button>
        <button id="green" style="background-color: green; color: white;">绿</button>
    </div>
    <canvas id="drawingCanvas" width="560" height="760"></canvas>
    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const penButton = document.getElementById('pen');
        const eraserButton = document.getElementById('eraser');
        const clearButton = document.getElementById('clear');
        const blackButton = document.getElementById('black');
        const redButton = document.getElementById('red');
        const blueButton = document.getElementById('blue');
        const greenButton = document.getElementById('green');
        
        let drawing = false;
        let mode = 'pen';
        let previousMode = 'pen';
        let currentColor = 'black'; // 当前颜色

        const lineWidth = {
            pen: 5,
            eraser: 30
        };

        const colors = {
            pen: 'black',
            eraser: 'white'
        };

        penButton.addEventListener('click', () => setMode('pen', penButton));
        eraserButton.addEventListener('click', () => setMode('eraser', eraserButton));
        clearButton.addEventListener('click', clearCanvas);
        blackButton.addEventListener('click', () => setColor('black', blackButton));
        redButton.addEventListener('click', () => setColor('red', redButton));
        blueButton.addEventListener('click', () => setColor('blue', blueButton));
        greenButton.addEventListener('click', () => setColor('green', greenButton));

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mousemove', draw);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchend', stopDrawing);
        canvas.addEventListener('touchmove', drawTouch);

        // 禁用右键菜单并处理右键功能
        canvas.addEventListener('contextmenu', (event) => event.preventDefault());
        canvas.addEventListener('mousedown', (event) => {
            if (event.button === 2) {
                previousMode = mode;
                setMode('eraser', eraserButton);
                startDrawing(event);
            }
        });
        canvas.addEventListener('mouseup', (event) => {
            if (event.button === 2) {
                setMode(previousMode, penButton); // 恢复之前的模式
                stopDrawing();
            }
        });

        function setMode(newMode, button) {
            mode = newMode;
            updateActiveButton(button);
            canvas.classList.toggle('custom-cursor', mode === 'eraser');
        }

        function setColor(color, button) {
            currentColor = color;
            colors.pen = color;
            updateActiveButton(button);
        }

        function startDrawing(event) {
            drawing = true;
            draw(event);
        }

        function stopDrawing() {
            drawing = false;
            ctx.beginPath();
        }

        function draw(event) {
            if (!drawing) return;
            const { clientX, clientY } = event.touches ? event.touches[0] : event;

            ctx.lineWidth = lineWidth[mode];
            ctx.lineCap = 'round';
            ctx.strokeStyle = mode === 'eraser' ? colors.eraser : currentColor;
            ctx.globalCompositeOperation = mode === 'eraser' ? 'destination-out' : 'source-over';

            const rect = canvas.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
            event.preventDefault();
        }

        function drawTouch(event) {
            draw(event);
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function updateActiveButton(activeButton) {
            [penButton, eraserButton, clearButton, blackButton, redButton, blueButton, greenButton].forEach(button => button.classList.remove('active'));
            activeButton.classList.add('active');
        }
    </script>
</body>
</html>
